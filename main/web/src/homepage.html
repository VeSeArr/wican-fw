<!doctypehtml><html lang=en><meta charset=UTF-8><meta content=width=1024 name=viewport><title>WiCAN</title><style>:root{--primary-color:#24478f;--primary-light:#c2d1f0;--primary-dark:#1a3266;--background-color:#f0f2f5;--white:#fff;--gray-100:#f7f7f7;--gray-200:#e9ecef;--gray-300:#dee2e6;--gray-400:#ced4da;--gray-500:#adb5bd;--gray-600:#6c757d;--gray-700:#495057;--shadow-sm:0 1px 3px #0000001f;--shadow-md:0 4px 6px #0000001a;--transition:all .3s ease}body{background-color:var(--background-color);color:var(--gray-700);margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;line-height:1.5;display:flex;overflow-x:hidden}.sidebar{background-color:var(--white);border-right:1px solid var(--gray-200);box-shadow:var(--shadow-sm);width:240px;height:100vh;padding-top:1rem;position:fixed;overflow-y:auto}.sidebar button{cursor:pointer;text-align:left;transition:var(--transition);color:var(--gray-600);background-color:#0000;border:none;outline:none;align-items:center;gap:.75rem;width:100%;padding:1rem 1.5rem;font-size:.95rem;display:flex}.sidebar button:hover{background-color:var(--gray-100);color:var(--primary-color)}.sidebar button.active{background-color:var(--primary-color);color:var(--white);font-weight:500}.logo{width:80%;max-width:100%;height:auto;max-height:100%;margin:2.5rem auto 0;padding:0;display:block}.content{width:calc(100% - 240px);max-width:1200px;margin-left:240px;padding:2rem}.tabcontent{background-color:var(--white);box-shadow:var(--shadow-md);border-radius:8px;margin-bottom:1.5rem;padding:1.5rem;display:none}.description-text{padding-left:.75rem;padding-right:.75rem}.form-table{border-collapse:separate;border-spacing:0 .5rem;width:100%;font-weight:600}.form-table td{vertical-align:middle;padding:.75rem}.form-table td:first-child{color:var(--gray-700);width:40%;font-weight:500}.slider-container{align-items:center;gap:10px;display:flex}input[type=range]{width:100%}input[type=text],input[type=file],input[type=number]{width:calc(100% - 1.3rem - 2px)}input,select{border:1px solid var(--gray-300);transition:var(--transition);background-color:var(--white);border-radius:6px;width:100%;padding:.65rem;font-size:.95rem}input:focus,input[type=number]:focus,select:focus{border-color:var(--primary-color);outline:none;box-shadow:0 0 0 3px #24478f1a}input:disabled,input[type=number]:disabled,select:disabled{background-color:var(--gray-100);cursor:not-allowed}button,input[type=button],.store{background-color:var(--primary-color);color:var(--white);cursor:pointer;transition:var(--transition);border:none;border-radius:6px;width:auto;padding:.65rem 1.25rem;font-weight:500}button:hover,input[type=button]:hover,.store:hover{background-color:var(--primary-dark)}button:disabled,input[type=button]:disabled,.store:disabled{background-color:var(--gray-400);cursor:not-allowed}.section-title{color:var(--primary-color);border-bottom:2px solid var(--primary-light);margin:0 0 1rem;padding-bottom:.5rem;font-size:1.5rem;font-weight:600}.divider{border-bottom:1px solid var(--gray-200);margin:1.5rem 0}#table2{border-collapse:separate;border-spacing:0;width:100%;margin:1rem 0}#table2 th,#table2 td{border:1px solid var(--gray-300);padding:.75rem}#table2 th{background-color:var(--gray-100);text-align:left;font-weight:600}#table2 tr:nth-child(2n){background-color:var(--gray-50)}.status-indicator{border-radius:1rem;align-items:center;padding:.25rem .75rem;font-size:.875rem;font-weight:500;display:inline-flex}.status-connected{color:#065f46;background-color:#d1fae5}.status-disconnected{color:#991b1b;background-color:#fee2e2}input[type=file]{border:1px dashed var(--gray-400);background-color:var(--gray-50);cursor:pointer;border-radius:6px;padding:.5rem}input[type=file]:hover{border-color:var(--primary-color)}input[type=checkbox]{cursor:pointer;width:1.25rem;height:1.25rem;margin-right:.5rem}.notification-container{z-index:1000;padding:1rem;font-weight:500;transition:all .3s;display:none;position:fixed;top:0;left:240px;right:0}.notification-container.show{display:block}.form-input::placeholder{color:#888;font-size:14px}.custom-init-group{margin-bottom:1.5rem}.custom-init-group label{color:var(--gray-700);margin-bottom:.5rem;display:block}.pid-entry{background:var(--white);color:var(--gray-600);border:none;border-radius:8px;margin-bottom:.2rem;padding:0;font-size:.95rem;font-weight:500}.pid-header{justify-content:space-between;align-items:center;margin-bottom:2rem;display:flex}.pid-title{color:var(--gray-700)}.pid-content{flex-direction:column;gap:1.5rem;display:flex}.pid-field{flex-direction:column;gap:.5rem;display:flex}.pid-field label{color:var(--gray-700)}.pid-field input,.pid-field select{border:1px solid var(--gray-300);border-radius:6px;width:50%;padding:.75rem}.button-group{gap:1rem;margin-top:1rem;display:flex}@media (width<=768px){.notification-container{left:0}}@media (width<=1024px){.sidebar{width:200px}.content{width:calc(100% - 200px);margin-left:200px}}.system-button{white-space:nowrap;width:auto;min-width:110px;margin:.1rem;padding:.65rem 1.25rem}@media (width<=768px){.system-button{width:100%;min-width:110px;margin:.1rem 0}.sidebar{width:100%;height:auto;position:relative}.content{width:100%;margin-left:0;padding:1rem}.form-table td{width:100%;display:block}.form-table td:first-child{padding-bottom:.25rem}.compact-form-table{border-collapse:collapse;width:100%}.compact-form-table td{vertical-align:middle;padding:3px;font-size:.85rem}.compact-form-table input,.compact-form-table select{border:1px solid var(--gray-300);border-radius:4px;width:95%;height:24px;padding:2px 5px;font-size:.85rem}}#wifi_networks_list option{padding:.25rem}.wifi-scan-container{align-items:center;gap:5px;display:flex}.wifi-scan-container input{flex:1}#wifi_scan_button{white-space:nowrap;min-width:60px}</style></head><body onload=Load();><div class=sidebar><embed class=logo src=/logo.svg><button onclick="openTab(event, 'status_view')"class=tablinks id=defaultOpen><span data-lucide=signal style=width:18px;height:18px;margin-right:8px></span> <b>Status</b></button><button onclick="openTab(event, 'wifi_settings')"class=tablinks><span data-lucide=settings style=width:18px;height:18px;margin-right:8px></span> <b>Settings</b></button><button onclick="openTab(event, 'automate')"class=tablinks><span data-lucide=zap style=width:18px;height:18px;margin-right:8px></span> <b>Automate</b></button><button onclick="openTab(event, 'dashboard_tab')"class=tablinks><span data-lucide=bar-chart-3 style=width:18px;height:18px;margin-right:8px></span> <b>Dashboard</b></button><button onclick="openTab(event, 'power_saving_tab')"class=tablinks><span data-lucide=battery style=width:18px;height:18px;margin-right:8px></span> <b>Power Saving</b></button><button onclick="openTab(event, 'logger')"class=tablinks><span data-lucide=file-text style=width:18px;height:18px;margin-right:8px></span> <b>Logger Settings</b></button><button onclick="openTab(event, 'monitor')"class=tablinks><span data-lucide=monitor style=width:18px;height:18px;margin-right:8px></span> <b>CAN Monitor</b></button><button onclick="openTab(event, 'advanced_tab')"class=tablinks><span data-lucide=settings style=width:18px;height:18px;margin-right:8px></span> <b>Advanced</b></button><button onclick="openTab(event, 'system_tab')"class=tablinks><span data-lucide=cpu style=width:18px;height:18px;margin-right:8px></span> <b>System</b></button><button onclick="openTab(event, 'about_tab')"class=tablinks><span data-lucide=info style=width:18px;height:18px;margin-right:8px></span> <b>About</b></button><div style="color:#24478f;text-align:center;background:#faa3a3;border:1px solid #fde68a;border-radius:8px;margin:2rem 1rem 1rem;padding:.75rem;font-size:.95rem;display:none"id=firmware-update-notice><span style=font-weight:600>New firmware available!</span><br><a href=https://github.com/meatpiHQ/wican-fw/releases id=firmware-update-link style=color:#2563eb;text-decoration:underline target=_blank>Download</a></div></div><div class=content><div class=notification-container id=notification></div><div class=tabcontent id=dashboard_tab><div class=section-title>Dashboard</div><div id=dashboard-content><p>Loading dashboard content...</p></div></div><div id=sleep_warning_div style=display:none><div class=divider></div><div class=section-title style=color:#dc2626>⚠️ Sleep Mode Disabled Warning</div><table class=form-table><tr><td colspan=2 style=background-color:#fee2e2;border-radius:6px;padding:1rem><strong>WARNING:</strong> Disabling sleep mode will continuously drain your vehicle's battery and may cause battery discharge when the vehicle is off. This should only be disabled for testing purposes.</td></tr><tr><td><label for=sleep_disable_agree><b>I understand the risks:</b></label></td><td><select id=sleep_disable_agree name=sleep_disable_agree onchange=submit_enable();><option value=no>No - I do not agree</option><option value=yes>Yes - I understand and agree</option></select></td></tr></table></div><div class=tabcontent id=status_view><div class=section-title>Status</div><table class=form-table><tr><td>WiFi Mode:</td><td><div id=wifi_mode_current>AP </div></td></tr><tr><td>AP Channel:</td><td><div id=ap_channel_status>6 </div></td></tr><tr><td>WiFi Station:</td><td><div id=sta_status>Not Connected </div></td></tr><tr><td>Station IP:</td><td><div id=sta_ip>192.168.3.1 </div></td></tr><tr><td>mDNS:</td><td><div id=mdns> </div></td></tr><tr><td>CAN Bitrate:</td><td><div id=can_bitrate_status>500K </div></td></tr><tr><td>CAN Mode:</td><td><div id=can_mode_status>Silent </div></td></tr><tr><td>Port Type:</td><td><div id=port_type_status>TCP </div></td></tr><tr><td>TCP/UDP Port:</td><td><div id=port_status>3333 </div></td></tr><tr><td>Battery Voltage:</td><td><div id=batt_voltage>12.8V </div></td></tr><tr><td><input value="Check status"id=check_status_button name=check_status_button onclick=checkStatus() type=button></td><td> </td></tr></table></div><div class=tabcontent id=wifi_settings><form action=/action_page id=configForm name=configForm onchange=submit_enable();><div class=section-title>AP Config</div><table class=form-table><tr><td>Mode:</td><td><select onchange="toggleSmartConnectConfig(); submit_enable();"id=wifi_mode name=wifi_mode><option value=AP>AP</option><option value=APStation>AP+Station</option><option value=BLEStation>BLE+Station</option><option value=SmartConnect>SmartConnect</option></select></td></tr><tr><td>AP Channel:</td><td><select id=ap_ch_value name=ap_ch_value><option value=1>1</option><option value=2>2</option><option value=3>3</option><option value=4>4</option><option value=5>5</option><option value=6>6</option><option value=7>7</option><option value=8>8</option><option value=9>9</option><option value=10>10</option><option value=11>11</option><option value=12>12</option><option value=13>13</option><option value=14>14</option></select></td></tr><tr><td>AP Password:</td><td><input id=ap_pass_value name=ap_pass_value value=Testpass></td></tr><tr><td>Auto-Disable AP:</td><td><select id=ap_auto_disable name=ap_auto_disable onchange=submit_enable();><option value=enable>Enable</option><option value=disable>Disable</option></select></td></tr></table><div id=smartconnect_config style=display:none><div class=divider></div><div class=section-title>SmartConnect Configuration</div><div class=divider></div><div style="color:#2563eb;border-bottom:2px solid #93c5fd;align-items:center;gap:8px;padding-bottom:.25rem;font-size:1.25rem;display:flex"class=section-title><span data-lucide=home style=width:20px;height:20px></span> Home Mode</div><table class=form-table><tr><td>Home SSID:</td><td><input id=home_ssid name=home_ssid oninput=submit_enable(); value=MeatPi></td></tr><tr><td>Home Password:</td><td><input id=home_password name=home_password oninput=submit_enable(); value=TomatoSauce></td></tr><tr><td>Home Security:</td><td><select id=home_security name=home_security onchange=submit_enable();><option value=wpa3>WPA3</option><option value=wpa2>WPA2</option></select></td></tr><tr><td>Home Protocol:</td><td><select id=home_protocol name=home_protocol onchange=submit_enable();><option value=elm327>elm327</option><option value=auto_pid>AutoPID</option></select></td></tr></table><div class=divider></div><div style="color:#059669;border-bottom:2px solid #6ee7b7;align-items:center;gap:8px;padding-bottom:.25rem;font-size:1.25rem;display:flex"class=section-title><span data-lucide=car style=width:20px;height:20px></span> Drive Mode</div><table class=form-table><tr><td>Drive Connection Type:</td><td><select onchange="toggleDriveConfig(); submit_enable();"id=drive_connection_type name=drive_connection_type><option value=wifi>WiFi</option><option value=ble>BLE</option></select></td></tr><tr id=drive_wifi_config><td>Drive SSID:</td><td><input id=drive_ssid name=drive_ssid oninput=submit_enable(); value=MeatPi></td></tr><tr id=drive_wifi_password><td>Drive Password:</td><td><input id=drive_password name=drive_password oninput=submit_enable(); value=TomatoSauce></td></tr><tr id=drive_wifi_security><td>Drive Security:</td><td><select id=drive_security name=drive_security onchange=submit_enable();><option value=wpa3>WPA3</option><option value=wpa2>WPA2</option></select></td></tr><tr><td>Drive Protocol:</td><td><select id=drive_protocol name=drive_protocol onchange=submit_enable();><option value=elm327>elm327</option><option value=auto_pid>AutoPID</option></select></td></tr><tr><td>Drive Mode Timeout:</td><td class=slider-container><input oninput="document.getElementById('drive_mode_timeout_value').textContent = this.value;submit_enable();"id=drive_mode_timeout max=600 min=10 name=drive_mode_timeout step=1 type=range value=60> <span id=drive_mode_timeout_value>60</span>sec</td></tr></table></div><div class=divider></div><div id=station_config_section><div class=section-title>Network Configuration</div><table class=form-table><tr><td>SSID:</td><td><div class=wifi-scan-container><input disabled id=ssid_value name=ssid_value value=MeatPi><button disabled id=wifi_scan_button onclick=scanWifiNetworks() type=button>Scan</button></div></td></tr><tr id=wifi_networks_row style=display:none><td>Available Networks:</td><td><select id=wifi_networks_list onchange=selectWifiNetwork()><option value>Select a network...</option></select></td></tr><tr><td>Password:</td><td><input disabled id=pass_value name=pass_value value=TomatoSauce></td></tr><tr><td>Security:</td><td><select disabled id=sta_security name=sta_security><option value=wpa3>WPA3</option><option value=wpa2>WPA2</option></select></td></tr></table><div class=divider></div><div class=section-title>Backup Networks <span style=color:#6b7280;font-size:.9rem;font-weight:400>(max 5)</span></div><div id=fallback_networks_container><div id=fallback_rows></div><div class=button-group><button id=add_fallback_button onclick=addFallbackNetworkRow() type=button>Add SSID</button></div><div style=color:#6b7280;margin-top:6px;font-size:12px>These SSIDs are used as backup networks if the primary station fails.</div></div></div><div class=divider></div><div class=section-title>BLE</div><table class=form-table><tr><td>Passkey:</td><td><input id=ble_pass_value max=999999 min=0 name=ble_pass_value type=number value=000000></td></tr><tr><td>BLE Status:</td><td><select id=ble_status name=ble_status onchange=submit_enable();><option value=enable>Enable</option><option selected value=disable>Disable</option></select></td></tr><tr><td>BLE Power:</td><td class=slider-container><input oninput="document.getElementById('ble_power_value').textContent = this.value;submit_enable();"id=ble_power max=9 min=-12 name=ble_power step=3 type=range value=9> <span id=ble_power_value>9</span>dBm</td></tr></table><div style="margin:8px 0;display:none"id=ble_warning_div><div style="background:linear-gradient(135deg,#fef3c7 0%,#fde68a 100%);border:1px solid #f59e0b;border-radius:8px;padding:12px;box-shadow:0 2px 4px #0000001a"><div style=align-items:center;margin-bottom:6px;display:flex><span data-lucide=alert-triangle style=margin-right:8px;font-size:16px></span><strong style=color:#92400e;font-size:14px>BLE Connection Warning</strong></div><div style=color:#78350f;font-size:13px;line-height:1.4>When BLE connects, WiFi AP is disabled. To restore WiFi AP: disconnect BLE and power cycle device.</div></div></div><div class=divider></div><div class=section-title>CAN</div><table class=form-table><tr><td>CAN Bitrate:</td><td><select id=can_datarate name=can_datarate><option value=5K>5K</option><option value=10K>10K</option><option value=20K>20K</option><option value=25K>25K</option><option value=50K>50K</option><option value=100K>100K</option><option value=125K>125K</option><option value=250K>250K</option><option value=500K>500K</option><option value=800K>800K</option><option value=1000K>1000K</option></select></td></tr><tr><td>CAN Mode:</td><td><select id=can_mode name=can_mode><option selected value=normal>Normal</option><option value=silent>Silent</option></select></td></tr><tr><td>Port Type:</td><td><select id=port_type name=port_type><option value=tcp>TCP</option><option value=udp>UDP</option></select></td></tr><tr><td>TCP/UDP Port:</td><td><input id=tcp_port_value max=65535 min=1 name=tcp_port_value type=number value=3333></td></tr><tr><td>Protocol:</td><td><select id=protocol name=protocol><option value=realdash66>realdash66</option><option value=slcan>slcan</option><option value=savvycan>savvyCAN</option><option value=elm327>elm327</option><option value=auto_pid>AutoPID</option></select></td></tr><tr><td>MQTT:</td><td><select id=mqtt_en name=mqtt_en><option value=enable>Enable</option><option selected value=disable>Disable</option></select></td></tr></table><div id=mqtt_en_div><div class=divider></div><div class=section-title>MQTT</div><table class=form-table><tr><td><label for=mqtt_url><b>MQTT URL:</b></label></td><td><input id=mqtt_url name=mqtt_url value=127.0.0.1></td></tr><tr><td><label for=mqtt_port><b>MQTT Port:</b></label></td><td><input id=mqtt_port max=65535 min=1 name=mqtt_port type=number value=1883></td></tr><tr><td><label for=mqtt_user><b>MQTT User:</b></label></td><td><input id=mqtt_user name=mqtt_user value=meatpi></td></tr><tr><td><label for=mqtt_pass><b>MQTT Pass:</b></label></td><td><input id=mqtt_pass name=mqtt_pass value=meatpi></td></tr><tr><td><label for=mqtt_tx_topic><b>TX Topic:</b></label></td><td><input id=mqtt_tx_topic name=mqtt_tx_topic></td><td><input id=mqtt_tx_en_checkbox name=mqtt_tx_en_checkbox onchange=txCheckBoxChanged() type=checkbox></td></tr><tr><td><label for=mqtt_rx_topic><b>RX Topic:</b></label></td><td><input id=mqtt_rx_topic name=mqtt_rx_topic></td><td><input id=mqtt_rx_en_checkbox name=mqtt_rx_en_checkbox onchange=rxCheckBoxChanged() type=checkbox></td></tr><tr><td><label for=mqtt_status_topic><b>Status Topic:</b></label></td><td><input id=mqtt_status_topic name=mqtt_status_topic></td></tr><tr><td><label for=mqtt_elm327_log><b>MQTT elm327 log:</b></label></td><td><select id=mqtt_elm327_log name=mqtt_elm327_log onchange=alert_elm327() style=width:93px><option value=enable>Enable</option><option value=disable>Disable</option></select></td></tr><tr><td> </td><td> </td></tr></table><div style=overflow-x:auto><div class=section-title>MQTT CAN Filter</div><table id=can_flt_table><tr><th style=text-align:left>CAN ID (dec)</th><th style=text-align:left>Name</th><th style=text-align:left>PID</th><th style=text-align:left>Index</th><th style=text-align:left>Start Bit</th><th style=text-align:left>Bit Length</th><th style=text-align:left>Expression</th><th style=text-align:left>Cycle ms</th><th><input id=store_canflt_button name=store_canflt_button onclick=storeCANFLT() style=width:100% type=button value=Store></th></tr><tr><td style=width:10%><input id=canId max=536870912 min=0 style=width:80% type=number></td><td style=width:20%><input id=name maxlength=16 style=width:90%></td><td style=width:10%><input id=pid style=width:80% type=number></td><td style=width:10%><input id=pindex style=width:80% type=number></td><td style=width:10%><input id=startBit max=63 min=0 style=width:80% type=number></td><td style=width:10%><input id=bitLength max=64 min=1 style=width:80% type=number></td><td style=width:20%><input id=expression maxlength=64 style=width:90%></td><td style=width:10%><input id=cycle max=1000 min=100 style=width:80% type=number></td><td><input value="Add ID"id=add_row_button name=add_row_button onclick=addCANFLTRow() style=width:100% type=button></td></tr></table></div></div></form></div><div class=tabcontent id=automate><div class=section-title>Automate</div><table class=form-table><tr><td>MQTT HA Discovery:</td><td><select onchange="toggleDestinationAndCycle(); toggleSendToFields(); enableAutoStoreButton();submit_enable();"id=ha_discovery name=ha_discovery><option value=disable>Disable</option></select></td></tr><tr><td>Grouping:</td><td><select onchange="toggleDestinationAndCycle(); toggleSendToFields(); enableAutoStoreButton();submit_enable();"id=grouping name=grouping><option value=disable>Disable</option><option value=enable>Enable</option></select></td></tr><tr><td>Destination Type:</td><td><select onchange="toggleGroupApiToken(); enableAutoStoreButton();submit_enable();"id=group_dest_type name=group_dest_type><option value=Default>Default</option><option value=MQTT_Topic>MQTT Topic</option><option value=HTTP>HTTP POST</option><option value=HTTPS>HTTPS POST</option><option value=ABRP_API>ABRP API</option></select></td></tr><tr id=group_api_token_row style=display:none><td>API Token:</td><td><input placeholder="Bearer token"id=group_api_token name=group_api_token oninput=enableAutoStoreButton();submit_enable();></td></tr><tr><td>Destination:</td><td><input disabled id=destination name=destination oninput=enableAutoStoreButton();submit_enable();></td></tr><tr><td>Cycle Time(ms):</td><td><input disabled id=group_cycle name=group_cycle oninput=enableAutoStoreButton();submit_enable(); value=5000></td></tr></table><div class=section-title>Standard PIDs</div><table class=form-table><tr><td>Standard PIDs:</td><td><select id=standard_pids name=standard_pids onchange=toggleStandardPIDOptions();enableAutoStoreButton();submit_enable();><option value=disable>Disable</option><option value=enable>Enable</option></select></td></tr><tr><td>ECU Protocol:</td><td><select id=ecu_protocol name=ecu_protocol onchange=enableAutoStoreButton();submit_enable();><option value=0>0- Automatic</option><option value=6>6- ISO 15765-4 (CAN 11bit/500K)</option><option value=7>7- ISO 15765-4 (CAN 29bit/500K)</option><option value=8>8- ISO 15765-4 (CAN 11bit/250K)</option><option value=9>9- ISO 15765-4 (CAN 29bit/250K)</option></select></td></tr><tr><td>Available PIDs:</td><td style=align-items:center;gap:5px;display:flex><select disabled id=available_pids name=available_pids onchange=enableAutoStoreButton();submit_enable(); style=flex:1></select> <button disabled id=add_pid_button onclick=addSelectedPID() style=margin-left:5px>Add PID</button> <button id=scan_pids_button onclick=scanAvailablePIDs() style=margin-left:5px>Scan PIDs</button></td></tr></table><div id=standard_pids_table><div class=std-pid-entries></div></div><div class=section-title>Vehicle Specific</div><table class=form-table><tr><td>Vehicle Specific:</td><td><select onchange="toggleCarModel(); toggleDestinationAndCycle(); enableAutoStoreButton();submit_enable();"id=car_specific name=car_specific><option value=disable>Disable</option><option value=enable>Enable</option></select></td></tr><tr><td>Vehicle Model:</td><td style=align-items:center;gap:5px;display:flex><select id=car_model name=car_model onchange=enableAutoStoreButton();submit_enable(); style=flex:1></select> <button onclick=fetchVehicleProfiles() style=margin-left:5px>Get Latest</button></td></tr><tr><td>Vehicle Profiles:</td><td><form enctype=multipart/form-data id=car_data_form><input id=car_data_file name=car_data_file onchange=loadLocalCarModels();submit_enable(); type=file></form></td></tr><tr><td>Specific Initialisation:</td><td><input id=specific_init name=specific_init oninput=enableAutoStoreButton()></td></tr></table><div id=specific_pids_table><div class=specific-pid-entries></div></div><div class=section-title>Custom PIDs</div><table class=form-table><tr><td>Custom Initialisation:</td><td><input id=initialisation name=initialisation oninput=enableAutoStoreButton()></td></tr></table><div id=automate_table><div class=pid-entries></div></div><div class=button-group><button class=primary-button onclick=addRowAutoTable()>New</button><button class=store disabled id=custom_pid_store onclick=storeAutoTableData()>Store</button></div></div><div class=tabcontent id=monitor><div class=section-title>Monitor Settings</div><table class=form-table><tr><td>Bitrate</td><td>Filter</td><td>Mask</td></tr><tr><td><select id=mon_datarate name=mon_datarate><option value=10K>10K</option><option value=20K>20K</option><option value=50K>50K</option><option value=100K>100K</option><option value=125K>125K</option><option value=250K>250K</option><option selected value=500K>500K</option><option value=800K>800K</option><option value=1000K>1Mbit</option></select></td><td><input id=mon_filter name=mon_filter value=00000000></td><td><input id=mon_mask name=mon_mask value=FFFFFFFF></td><td><input id=mon_button name=mon_button onclick=mon_control() style=font-size:100% type=button value=Start></td></tr></table><div class=divider></div><table class=form-table id=table2><thead><tr><th>ID</th><th>Type</th><th>Len</th><th>Data</th><th>Time</th><th>Count</th></tr></thead><tbody></tbody></table></div><div class=tabcontent id=power_saving_tab><div class=section-title>Sleep Mode</div><table class=form-table><tr><td>Sleep Mode:</td><td><select id=sleep_status name=sleep_status onchange=toggleSleepWarning();submit_enable();><option value=enable>Enable</option><option value=disable>Disable</option></select></td></tr><tr><td>Sleep Voltage:</td><td class=slider-container><input oninput="document.getElementById('sleep_volt_value').textContent = this.value;submit_enable();"id=sleep_volt max=15.0 min=12.0 name=sleep_volt step=0.1 type=range value=13.2> <span id=sleep_volt_value>13.2</span>V</td></tr><tr><td>Sleep After:</td><td class=slider-container><input oninput="document.getElementById('sleep_time_value').textContent = this.value;submit_enable();"id=sleep_time max=30 min=1 name=sleep_time step=1 type=range value=5> <span id=sleep_time_value>5</span>min</td></tr><tr><td>Periodic wake up:</td><td><select id=periodic_wakeup name=periodic_wakeup onchange=submit_enable();><option value=enable>Enable</option><option value=disable>Disable</option></select></td></tr><tr id=wakeup_every_row><td>Wakeup Every:</td><td class=slider-container><input oninput="document.getElementById('wakeup_interval_value').textContent = this.value;submit_enable();"id=wakeup_interval max=240 min=5 name=wakeup_interval step=1 type=range value=60> <span id=wakeup_interval_value>60</span>min</td></tr><tr><td>Battery Alert:</td><td><select id=batt_alert name=batt_alert onchange=submit_enable();><option value=disable>Disable</option></select></td></tr></table><div id=batt_alert_div><div class=divider></div><div class=section-title>Battery Alert</div><table class=form-table><tr><td><label for=batt_alert_ssid><b>SSID:</b></label></td><td><input id=batt_alert_ssid name=batt_alert_ssid value=MeatPi></td></tr><tr><td><label for=batt_alert_pass><b>Password:</b></label></td><td><input id=batt_alert_pass name=batt_alert_pass value=TomatoSauce></td></tr><tr><td><label for=batt_alert_volt><b>Alert Voltage:</b></label></td><td><input id=batt_alert_volt max=15.0 min=9.0 name=batt_alert_volt step=0.1 type=number value=11.0></td></tr><tr><td><label for=batt_alert_protocol><b>Alert Protocol:</b></label></td><td><select id=batt_alert_protocol name=batt_alert_protocol style=width:93px><option value=mqtt>MQTT</option></select></td></tr><tr><td><label for=batt_alert_url><b>Alert URL:</b></label></td><td><input id=batt_alert_url name=batt_alert_url value=127.0.0.1></td></tr><tr><td><label for=batt_alert_port><b>Alert Port:</b></label></td><td><input id=batt_alert_port max=65535 min=1 name=batt_alert_port type=number value=1883></td></tr><tr><td><label for=batt_mqtt_user><b>Alert MQTT User:</b></label></td><td><input id=batt_mqtt_user name=batt_mqtt_user value=meatpi></td></tr><tr><td><label for=batt_mqtt_pass><b>Alert MQTT Pass:</b></label></td><td><input id=batt_mqtt_pass name=batt_mqtt_pass value=meatpi></td></tr><tr><td><label for=batt_alert_topic><b>Alert Topic:</b></label></td><td><input id=batt_alert_topic name=batt_alert_topic value=CAR1/voltage></td></tr><tr><td><b>Alert every:</b></td><td><select id=batt_alert_time name=batt_alert_time style=width:93px><option value=1>1hr</option><option value=6>6hr</option><option value=12>12hr</option><option value=24>1day</option></select></td></tr><tr><td> </td><td> </td></tr></table></div></div><div class=tabcontent id=logger><div class=section-title>Logger Settings</div><table class=form-table><tr><td>Logger:</td><td><select id=logger_status name=logger_status onchange=submit_enable();><option value=enable>Enable</option><option value=disable>Disable</option></select></td></tr><tr><td>Log Storage:</td><td><select id=log_storage name=log_storage onchange=submit_enable();><option value=sdcard>SDcard</option></select></td></tr><tr><td>Storage Filesystem:</td><td><select id=log_filesystem name=log_filesystem onchange=submit_enable();><option value=fatfs>FATFS</option></select></td></tr><tr><td>Log Period:</td><td class=slider-container><input oninput="document.getElementById('log_period_value').textContent = this.value;submit_enable();"id=log_period max=300 min=10 name=log_period step=1 type=range value=60> <span id=log_period_value>60</span>sec</td></tr></table></div><div class=tabcontent id=advanced_tab><div class=section-title>Advanced Settings</div><table class=form-table><tr><td>Motion Threshold:</td><td class=slider-container><input oninput="document.getElementById('imu_threshold_value').textContent = (this.value * 3.9).toFixed(1) + ' mg';submit_enable();"id=imu_threshold max=32 min=1 name=imu_threshold onchange=submit_enable(); step=1 type=range value=8> <span id=imu_threshold_value>31.2 mg</span></td></tr></table></div><div class=tabcontent id=system_tab><div class=section-title>System</div><table class=form-table><tr><td>Reboot WiCAN:</td><td><input class=system-button id=reboot_button name=reboot_button onclick=reboot() type=button value=Reboot></td></tr><tr><td>Download Configuration:</td><td><input class=system-button id=download_cfg_butt name=download_cfg_butt onclick=downloadCfg() type=button value=Download></td></tr><tr><td>Upload Configuration:</td><td><input class=system-button onclick=document.getElementById('fileInput').click() type=button value=Upload> <input accept=.json id=fileInput onchange=uploadCfg() style=display:none type=file></td></tr></table><div class=section-title>Firmware Update</div><div class=description-text>Firmware updates are available on <a href=https://github.com/meatpiHQ/wican-fw/releases>GitHub</a>. Instructions are available <a href=https://meatpihq.github.io/wican-fw/config/firmware-update>here</a>.</div><form action=/upload/ota.bin enctype=multipart/form-data id=ota_form method=post><table class=form-table><tr><td><input accept=.bin id=ota_file name=ota_file type=file></td><td><input class=system-button id=ota_submit_button onclick=otaClick() type=button value=Update></td></tr></table></form><div class=section-title>Certificate Manager</div><div class=description-text>Manage up to 10 named certificate sets. Each set may include: CA (for custom trust), and/or client certificate & key for mutual TLS. Enter a unique name (immutable), choose files, then Add. Delete removes the set directory.</div><div style="background:#f1f5f9;border:1px solid #e2e8f0;border-radius:6px;margin:.75rem 0;padding:.75rem"><table class=form-table style=width:100%><tr><td style=width:140px>New Cert Name:</td><td style=align-items:center;gap:.5rem;display:flex><input placeholder="e.g. abrp_prod"id=certmgr_name maxlength=24 style=flex:1> <input value="Add Set"class=system-button onclick=certManagerAddSet(); type=button></td></tr><tr><td>CA Certificate:</td><td><input accept=.pem,.crt id=certmgr_ca type=file></td></tr><tr><td>Client Certificate:</td><td><input accept=.pem,.crt id=certmgr_client_cert type=file></td></tr><tr><td>Client Key:</td><td><input accept=.pem,.key id=certmgr_client_key type=file></td></tr></table><div style=color:#555;font-size:.75rem>Name: letters, digits, dash, underscore. CA file strongly recommended unless using system trust. Client cert+key optional but must both be provided for mutual TLS.</div></div><div style=margin-top:1rem><div style=margin-bottom:.5rem;font-weight:600>Existing Sets</div><table id=certmgr_table style=border-collapse:collapse;width:100%><thead><tr style=background:#f8fafc><th style="text-align:left;border:1px solid #e2e8f0;padding:6px">Name</th><th style="text-align:left;border:1px solid #e2e8f0;padding:6px">CA</th><th style="text-align:left;border:1px solid #e2e8f0;padding:6px">Client Cert</th><th style="text-align:left;border:1px solid #e2e8f0;padding:6px">Client Key</th><th style="text-align:left;border:1px solid #e2e8f0;padding:6px"></th></tr></thead><tbody id=certmgr_body><tr><td colspan=5 style=text-align:center;color:#555;padding:8px>No certificate sets</td></tr></tbody></table></div><div style=color:#666;margin-top:.75rem;font-size:.7rem>Single-cert uploads appear as the read-only 'default' set.</div></div><div class=tabcontent id=about_tab><div class=section-title>About</div><table class=form-table><tr><td>Firmware ver:</td><td><div id=fw_version>1.00</div></td></tr><tr><td>Hardware ver:</td><td><div id=hw_version>v2.10</div></td></tr><tr><td>Git ver:</td><td><div id=git_version>v2.10</div></td></tr><tr><td>Designed By:</td><td><div id=made_by><a href=https://www.meatpi.com/><b>meatpi.com</b></a></div></td></tr></table></div><input value="Submit Changes"disabled id=submit_button name=submit_button onclick=postConfig() type=button></div><script>var fetchVehicleProfiles=(async()=>{let b=Error;try{if(!navigator.onLine){throw new b(`No internet connection`)};const c=await fetch(`https://raw.githubusercontent.com/meatpiHQ/wican-fw/main/vehicle_profiles.json`);if(!c.ok){throw new b(`Network response was not ok`)};const d=await c.json();console.log(d);latest_car_models=d;const e=[];e.push(`Not Selected`);if(d&&Array.isArray(d.cars)){d.cars.forEach(a=>{if(a.car_model){e.push(a.car_model)}})};console.log(e);var a={"supported":e};loadCarModels(a);enableAutoStoreButton()}catch(a){console.error(`There was a problem with the fetch operation:`,a);showNotification(`Unable to fetch vehicle_profiles.json. `+ a.message,`red`)}});var bindEvents=(()=>{let e=``,i=`h`,a=0,j=9,g=1,h=3,d=2,f=` `,k=8,c=`0`,b=4;ws.onmessage=(l=>{var m=l.data;if(m[a]==`t`){var n=(m[b]- c)*d;var o=e;var p;for(p=a;p<n;p+=d){o+=m.substr(p+ 5,d)+ f};monitor_add_line(m.substr(g,h)+ i,`Std`,m[b],o,a)}else if(m[a]==`T`){var n=(m[j]- c)*d;var o=e;var p;for(p=a;p<n;p+=d){o+=m.substr(p+ 10,d)+ f};monitor_add_line(m.substr(g,k)+ i,`Ext`,m[j],o,a)}else if(m[a]==`r`){var n=(m[b]- c)*d;monitor_add_line(m.substr(g,h)+ i,`RTR-Std`,m[b],a,a)}else if(m[a]==`R`){var n=(m[j]- c)*d;monitor_add_line(m.substr(g,k)+ i,`RTR-Ext`,m[j],a,a)}})});var loadautoPID=(()=>{console.log(`Loading auto PID data...`);const a=new XMLHttpRequest();a.onload=function(){console.log(`Server response:`,this.responseText);if(this.responseText!==`NONE`){const a=JSON.parse(this.responseText);loadAutoTable(a);document.getElementById(`custom_pid_store`).disabled=!0}else{console.log(`No PID data found on server`)}};a.onerror=(a=>{console.error(`Error loading auto PID:`,a)});a.open(`GET`,`/load_auto_pid`);a.send()});var rxCheckBoxChanged=(()=>{let a=`mqtt_rx_topic`;if(document.getElementById(`mqtt_rx_en_checkbox`).checked){document.getElementById(a).disabled=!1}else{document.getElementById(a).disabled=!0}});var submit_enable=(()=>{console.log(`submit_enable`);const a=getElements();const b=a.wifiMode.value;configureWifiModeSettings(a,b);handleBleStatus(a);const c=validateForm(a,b);a.submitButton.disabled=!c;configureProtocolSettings(a);configureSleepSettings(a);configureMqttAndBatteryAlerts(a);configurePeriodicWakeup(a)});var loadLocalCarModels=(()=>{let d=0,e=`red`,f=`green`;const a=document.getElementById(`car_data_file`);if(a.files.length==d){showNotification(`No files selected!`,e);return};const b=a.files[d];const c=new FileReader();c.onload=(async(a)=>{try{const c=JSON.parse(a.target.result);let d;if(c.car_model&&c.pids){showNotification(`Single car format detected. Fetching parameter definitions...`,`blue`);try{const a=await fetch(`https://raw.githubusercontent.com/meatpiHQ/wican-fw/refs/heads/main/.vehicle_profiles/params.json`);const b=await a.json();const e=convertSingleCarFormat(c,b);d={cars:[e]};showNotification(`Single car format converted successfully!`,f)}catch(a){console.warn(`Failed to fetch params.json, using basic conversion:`,a);d={cars:[convertSingleCarBasic(c)]};showNotification(`Car model loaded (basic format - no internet connection)`,`yellow`)}}else{d=c.car_model?{cars:[c]}:c};latest_car_models=d;const e=[];e.push(`Not Selected`);if(d&&Array.isArray(d.cars)){d.cars.forEach(a=>{if(a.car_model){e.push(a.car_model)}})};console.log(e);var b={"supported":e};loadCarModels(b);enableAutoStoreButton();if(!c.car_model||!c.pids){showNotification(`Car models loaded successfully!`,f)}}catch(a){showNotification(`Invalid JSON file!`,e);console.error(`JSON parse error:`,a)}});c.readAsText(b)});var getSignalQuality=(a=>{if(a>=-50)return `Excellent`;if(a>=-60)return `Good`;if(a>=-70)return `Fair`;return `Weak`});var configureProtocolSettings=(a=>{let d=0;const b=a.protocol.value===`savvycan`;const c=a.protocol.value===`elm327`;if(b){a.tcpPortValue.value=`23`;a.tcpPortValue.disabled=!0;a.portType.selectedIndex=d;a.portType.disabled=!0}else{a.tcpPortValue.disabled=!1;a.portType.selectedIndex=d;a.portType.disabled=!1};a.mqttElm327Log.disabled=!c;if(!c){a.mqttElm327Log.value=`disable`}});var renderFallbackNetworks=(a=>{const b=document.getElementById(`fallback_rows`);if(!b)return;b.innerHTML=``;const c=Array.isArray(a)?a.slice(0,5):[];c.forEach(a=>addFallbackNetworkRow(a));updateAddFallbackButtonState()});var validateSmartConnect=(()=>{const a=document.getElementById(`home_ssid`).value.trim();const b=document.getElementById(`home_password`).value.trim();const c=document.getElementById(`drive_connection_type`).value;const d=document.getElementById(`drive_ssid`).value.trim();const e=document.getElementById(`drive_password`).value.trim();if(!a||!b){return disableSubmitWithError(`SmartConnect: Home SSID and Password are required`)};if(c===`wifi`&&(!d||!e)){return disableSubmitWithError(`SmartConnect: Drive SSID and Password are required when WiFi is selected`)};return !0});var loadautoPIDCarData=(()=>{const a=new XMLHttpRequest();a.onload=function(){console.log(`Car models:`,this.responseText);if(this.responseText!=`NONE`){var a=JSON.parse(this.responseText);const c=[];if(a&&Array.isArray(a.cars)){a.cars.forEach(a=>{if(a.car_model){c.push(a.car_model)};if(a.pids){document.getElementById(`specific_init`).value=a.init;a.pids.forEach(a=>{if(a.parameters){a.parameters.forEach(b=>{addCarParameter({name:b.name,expression:b.expression,unit:b.unit,class:b.class,period:b.period,type:b.type,min:b.min,max:b.max,send_to:b.send_to,pid:a.pid,pid_init:a.pid_init})})}})}})};var b={"supported":c};loadCarModels(b)}else{toggleCarModel();toggleDestinationAndCycle();toggleSendToFields();toggleStandardPIDOptions()}};a.open(`GET`,`/load_auto_pid_car_data`);a.send()});var toggleSendToFields=(()=>{const a=document.getElementById(`grouping`)?.value||`disable`;const b=document.getElementById(`automate_table`);if(!b)return;const c=b.getElementsByClassName(`pid-entry`);if(!c.length)return;Array.from(c).forEach(b=>{const c=b.querySelector(`.send-to-input`);if(c){c.disabled=a===`Group ALL`}})});var sta_enable=(()=>{});var setRTCTime=(()=>{let d=10;var b=(a=>Math.floor(a/d)*16+ a%d);const a=new Date();const c={command:`set_rtc_time`,hour:b(a.getUTCHours()),min:b(a.getUTCMinutes()),sec:b(a.getUTCSeconds()),year:b(a.getUTCFullYear()%100),month:b(a.getUTCMonth()+ 1),day:b(a.getUTCDate()),weekday:b(a.getUTCDay())};fetch(`/system_commands`,{method:`POST`,headers:{'Content-Type':`application/json`},body:JSON.stringify(c)}).then(a=>a.text()).then(a=>{console.log(`RTC time set successfully (UTC):`,a)}).catch(a=>{console.error(`Error setting RTC time:`,a)})});var showNotification=((a,b=e,c=5000)=>{let e=`red`,f=`#fee2e2`,i=`show`,g=`#ef4444`,h=`#991b1b`;const d=document.getElementById(`notification`);switch(b){case e:d.style.backgroundColor=f;d.style.borderColor=g;d.style.color=h;break;case `green`:d.style.backgroundColor=`#dcfce7`;d.style.borderColor=`#22c55e`;d.style.color=`#166534`;break;case `blue`:d.style.backgroundColor=`#dbeafe`;d.style.borderColor=`#3b82f6`;d.style.color=`#1e40af`;break;case `yellow`:d.style.backgroundColor=`#fef9c3`;d.style.borderColor=`#eab308`;d.style.color=`#854d0e`;break;default:d.style.backgroundColor=f;d.style.borderColor=g;d.style.color=h}d.innerHTML=a;d.classList.add(i);if(window.notificationTimeout){clearTimeout(window.notificationTimeout)};window.notificationTimeout=setTimeout(()=>{d.classList.remove(i)},c)});var txCheckBoxChanged=(()=>{let a=`mqtt_tx_topic`;if(document.getElementById(`mqtt_tx_en_checkbox`).checked){document.getElementById(a).disabled=!1}else{document.getElementById(a).disabled=!0}});var loadCANFLT=(()=>{let b=`NONE`;const a=new XMLHttpRequest();a.onload=function(){if(this.responseText===b){return};var a=JSON.parse(this.responseText);if(this.responseText!=b){if(Array.isArray(a.can_flt)){a.can_flt.forEach(a=>{restoreCANFLTRow(a[`CANID`],a[`Name`],a[`PID`],a[`PIDIndex`],a[`StartBit`],a[`BitLength`],a[`Expression`],a[`Cycle`])})}}};a.open(`GET`,`/load_canflt`);a.send()});var configurePeriodicWakeup=(a=>{let c=`disable`,d=`none`;const b=a.sleepStatus.value===c;if(b){a.periodicWakeup.disabled=!0;a.periodicWakeup.value=c;a.wakeupEveryRow.style.display=d}else{a.periodicWakeup.disabled=!1;const b=a.periodicWakeup.value===`enable`;a.wakeupEveryRow.style.display=b?`table-row`:d}});var toggleDestinationField=(()=>{const a=document.getElementById(`grouping`).value;toggleDestinationAndCycle()});var configureWifiModeSettings=((a,b)=>{const c=b===`AP`;const d=b===`SmartConnect`;const e=b===`BLEStation`;a.ssidValue.disabled=c;a.passValue.disabled=c;a.staSecurity.disabled=c;a.apAutoDisable.disabled=c;a.wifiScanButton.disabled=c;if(c){a.bleStatus.disabled=!1;a.blePassValue.disabled=!1}else if(e){a.bleStatus.disabled=!0;a.bleStatus.value=`enable`;a.bleStatus.selectedIndex=0;a.blePassValue.disabled=!1}else if(d){a.bleStatus.disabled=!0;a.blePassValue.disabled=!0}else{a.bleStatus.disabled=!0;a.bleStatus.value=`disable`;a.bleStatus.selectedIndex=1;a.blePassValue.disabled=!0}});var validatePort=(a=>{const b=parseInt(a);return b>=1&&b<=65535});var enableAutoStoreButton=(()=>{const a=document.querySelector(`button.store`);if(a){a.disabled=!1};document.getElementById(`custom_pid_store`).disabled=!1});var loadCarModels=(a=>{const b=document.getElementById(`car_model`);if(a&&Array.isArray(a.supported)){b.innerHTML=``;a.supported.forEach(a=>{const c=document.createElement(`option`);c.value=a;c.text=a;b.appendChild(c)})}else{console.error(`Invalid data format or missing 'supported' property.`)};toggleCarModel();toggleDestinationAndCycle();toggleSendToFields();toggleStandardPIDOptions();toggleSmartConnectConfig()});var certManagerAddSet=(async()=>{let j=``,l=0,k=`red`;const a=document.getElementById(`certmgr_name`);const b=document.getElementById(`certmgr_ca`);const c=document.getElementById(`certmgr_client_cert`);const d=document.getElementById(`certmgr_client_key`);const e=(a.value||j).trim();if(!certManagerValidateName(e)){showNotification(`Invalid name`,k);return};if(certManagerSets.some(a=>a.name===e)){showNotification(`Name exists`,k);return};const f=b.files[l];const g=c.files[l];const h=d.files[l];if(!f&&!(g&&h)){showNotification(`Need CA or client cert+key`,k);return};const i=new FormData();if(f)i.append(`ca_cert`,f,`ca.pem`);if(g)i.append(`client_cert`,g,`client.crt`);if(h)i.append(`client_key`,h,`client.key`);try{const a=document.querySelector(`#certmgr_controls button`);if(a)a.disabled=!0;const b=await fetch(`/cert_manager/sets?name=`+ encodeURIComponent(e),{method:`POST`,body:i});if(!b.ok){const a=await b.text();showNotification(`Upload failed `+ a,k)}else{showNotification(`Uploaded`,`green`);certManagerLoad()}}catch(a){showNotification(`Upload error`,k)}finally{if(btn)btn.disabled=!1}a.value=j;b.value=j;c.value=j;d.value=j});var addCANFLTRow=(()=>{let F=64,E=0,H=1,v=`startBit`,x=`cycle`,w=`bitLength`,D=``,G=100,y=`name`,u=`canId`,I=7,A=`pid`,B=`pindex`,z=`expression`,C=isNaN,t=parseInt;var a=t(document.getElementById(u).value);var b=t(document.getElementById(v).value);var c=t(document.getElementById(w).value);Length=t(document.getElementById(w).value);var d=t(document.getElementById(x).value);var e=document.getElementById(y).value;var f=document.getElementById(z).value;var g=t(document.getElementById(A).value);var h=t(document.getElementById(B).value);if(C(a)||a==D||a<E||a>536870912){alert(`CAN ID must be a valid number between 0 and 536870912`);return};if(C(b)||C(c)||b>F- c||c<=E||c>F||b<E||b>63){alert(`startBit or bitLength error`);return};if(C(d)||d<G||d>10000){alert(`cycle must be between 100 and 10000`);return};if(e.length<H||e.length>16){alert(`Name must be between 1 and 16 characters in length.`);return};if(f.length<H||f.length>F){alert(`Expression must be between 1 and 64 characters in length.`);return};if(C(g)||g<-H||g>255){alert(`PID must be a number between -1 and 255`);return};if(C(h)||h<E||h>I){alert(`PID must be a number between 0 and 7`);return};if(isNameUnique(e)){var i=document.getElementById(`can_flt_table`);var j=i.insertRow(-H);var k=j.insertCell(E);var l=j.insertCell(H);var m=j.insertCell(2);var n=j.insertCell(3);var o=j.insertCell(4);var p=j.insertCell(5);var q=j.insertCell(6);var r=j.insertCell(I);var s=j.insertCell(8);if(i.rows.length- H>=G){alert(`Maximum row limit (100) reached.`);return};k.innerHTML=a;l.innerHTML=e;m.innerHTML=g;n.innerHTML=h;o.innerHTML=b;p.innerHTML=c;q.innerHTML=f;r.innerHTML=d;s.innerHTML=`<button style="width: 100%;" onclick="deleteCANFLTRow(this) ">Delete</button>`;canData.push({CANID:a,Name:e,PID:g,PIDIndex:h,StartBit:b,BitLength:c,Expression:f,Cycle:d});document.getElementById(u).value=D;document.getElementById(y).value=D;document.getElementById(A).value=D;document.getElementById(B).value=D;document.getElementById(v).value=D;document.getElementById(w).value=D;document.getElementById(z).value=D;document.getElementById(x).value=D}else{alert(`Name must be unique.`)};document.getElementById(`store_canflt_button`).disabled=!1});var checkStatus=(()=>{let g=`batt_alert`,h=`enable`,j=`none`,f=`port_type_status`,k=`disable`,m=`mqtt_en_div`,e=`can_mode_status`,c=`AP`,l=`mqtt_en`,i=`batt_alert_div`,b=`wifi_mode_current`,d=`SmartConnect`;const a=new XMLHttpRequest();a.onload=function(){var a=JSON.parse(this.responseText);if(a.wifi_mode==`APStation`){document.getElementById(b).innerHTML=`AP+Station`}else if(a.wifi_mode==`BLEStation`){document.getElementById(b).innerHTML=`BLE+Station`}else if(a.wifi_mode==c){document.getElementById(b).innerHTML=c}else if(a.wifi_mode==d){document.getElementById(b).innerHTML=d};document.getElementById(`sta_status`).innerHTML=a.sta_status;document.getElementById(`ap_channel_status`).innerHTML=a.ap_ch;document.getElementById(`sta_ip`).innerHTML=a.sta_ip;document.getElementById(`mdns`).innerHTML=a.mdns;document.getElementById(`can_bitrate_status`).innerHTML=a.can_datarate;if(a.can_mode==`normal`){document.getElementById(e).innerHTML=`Normal`}else if(a.can_mode==`silent`){document.getElementById(e).innerHTML=`Silent`};if(a.port_type==`tcp`){document.getElementById(f).innerHTML=`TCP`}else if(a.port_type==`udp`){document.getElementById(f).innerHTML=`UDP`};document.getElementById(`port_status`).innerHTML=a.port;document.getElementById(`fw_version`).innerHTML=a.fw_version;document.getElementById(`hw_version`).innerHTML=a.hw_version;document.getElementById(`git_version`).innerHTML=a.git_version;document.getElementById(`protocol`).value=a.protocol;document.getElementById(`batt_voltage`).innerHTML=a.batt_voltage;if(document.getElementById(g).value==h){document.getElementById(i).style.display=j}else if(document.getElementById(g).value==k){document.getElementById(i).style.display=j};if(document.getElementById(l).value==h){document.getElementById(m).style.display=`block`}else if(document.getElementById(l).value==k){document.getElementById(m).style.display=j};checkFirmwareUpdate()};a.open(`GET`,`/check_status`);a.send()});var convertSingleCarBasic=(a=>{const b={car_model:a.car_model,init:a.init,pids:[]};a.pids.forEach(a=>{const c={pid:a.pid,parameters:[]};if(a.pid_init){c.pid_init=a.pid_init};if(a.parameters&&typeof a.parameters===`object`){Object.keys(a.parameters).forEach(b=>{const d=a.parameters[b];const e={name:b,expression:d,unit:``,class:`none`};c.parameters.push(e)})};b.pids.push(c)});return b});var updateAddFallbackButtonState=(()=>{const a=document.getElementById(`add_fallback_button`);if(!a)return;const b=document.querySelectorAll(`#fallback_rows .fallback-row`).length;a.disabled=b>=5||document.getElementById(`wifi_mode`).value===`SmartConnect`});var toggleDiscovery=(()=>{const a=document.getElementById(`car_specific`).value;const b=document.getElementById(`ha_discovery`);b.disabled=!0;b.value=`disable`});var selectWifiNetwork=(()=>{const a=document.getElementById(`wifi_networks_list`);const b=document.getElementById(`ssid_value`);if(a.value){b.value=a.value;submit_enable();enableAutoStoreButton()}});var monitor_add_line=((a,b,c,d,e)=>{let r=0,w=5,q=1,t=3,s=2,u=4,v=Date.now;var f=document.getElementById(`table2`);var g=-q;if(typeof monitor_add_line.msg_time==`undefined`){monitor_add_line.msg_time=[r]};for(var h=q,i=f.rows.length;h<i;h++){if(f.rows[h].cells[r].innerHTML==a){g=h;break}};if(g!=-q){f.rows[g].cells[r].innerHTML=a;f.rows[g].cells[q].innerHTML=b;f.rows[g].cells[s].innerHTML=c;f.rows[g].cells[t].innerHTML=d;f.rows[g].cells[u].innerHTML=v()- monitor_add_line.msg_time[g];f.rows[g].cells[w].innerHTML=++f.rows[g].cells[w].innerHTML;monitor_add_line.msg_time[g]=v()}else{var j=f.insertRow(q);var k=j.insertCell(r);var l=j.insertCell(q);var m=j.insertCell(s);var n=j.insertCell(t);var o=j.insertCell(u);var p=j.insertCell(w);k.innerHTML=a;l.innerHTML=b;m.innerHTML=c;n.innerHTML=d;o.innerHTML=r;p.innerHTML=q;k.style.width=`10%`;monitor_add_line.msg_time.push(v())}});var otaClick=(()=>{let a=`No files selected!`;if(document.getElementById(`ota_file`).files.length==0){showNotification(a,`red`);alert(a)}else{document.getElementById(`ota_submit_button`).disabled=!0;showNotification(`Updating please wait...`,`green`);setTimeout((()=>{document.getElementById(`ota_form`).submit()}),5000)}});var storeAutoTableData=(async()=>{let s=`Name must not be empty and must be less than 32 characters`,d=0,g=`.name-input`,j=`.type-select`,k=`.send-to-input`,h=`.expression-input`,i=`.period-input`,a=``,m=`application/json`,r=32,q=`red`,b=`disable`,t=64,f=`.pid-input`,p=1000,c=`Default`,u=`Send_to must be less than 64 characters`,l=`POST`,e=Error,n=JSON.stringify,o=parseInt;try{const v=[];const w=[];const x=document.querySelectorAll(`.pid-entry`);const y=document.querySelectorAll(`.std-pid-entry`);const z=document.getElementById(`initialisation`)?.value||a;const A=document.getElementById(`grouping`)?.value||b;const B=document.getElementById(`group_dest_type`)?.value||c;const C=document.getElementById(`ha_discovery`)?.value||b;const D=document.getElementById(`group_api_token`)?.value||a;const E=document.getElementById(`destination`)?.value||a;const F=document.getElementById(`group_cycle`);const G=F?.value||`5000`;const H=document.getElementById(`car_specific`)?.value||b;const I=document.getElementById(`car_model`);const J=document.getElementById(`standard_pids`)?.value||b;const K=document.getElementById(`ecu_protocol`)?.value||`6`;const L=I?.value||a;if(H==`enable`&&(!L||L.length===d||L===`Not Selected`)){throw new e(`Car model must be selected`)};let M={car_model:L,init:document.getElementById(`specific_init`).value,pids:[]};const N=document.querySelectorAll(`.specific-pid-entry`);if(N.length>d){M.pids=Array.from(N).map(a=>({pid:a.querySelector(f).value,pid_init:a.querySelector(`.pid-init-input`).value,parameters:[{name:a.querySelector(g).value,expression:a.querySelector(h).value,unit:a.querySelector(`.unit-input`).value,class:a.querySelector(`.class-input`).value,period:a.querySelector(i).value,min:a.querySelector(`.min-input`).value,max:a.querySelector(`.max-input`).value,type:a.querySelector(j).value,send_to:a.querySelector(k).value}]}))};fetch(`/store_car_data`,{method:l,headers:{'Content-Type':m},body:n({cars:[M]})}).then(a=>a.text()).then(a=>console.log(`Success:`,a)).catch(a=>console.error(`Error:`,a));if(!F.disabled&&(!/^\d+$/.test(G)||o(G)<p)){showNotification(`Cycle must be a number greater than 1000`,q);return !1};if(x?.length){x.forEach((b,l)=>{const m={Name:b.querySelector(g)?.value||a,Init:b.querySelector(`.init-input`)?.value||a,PID:b.querySelector(f)?.value||a,Expression:b.querySelector(h)?.value||a,MinValue:b.querySelector(`.min-value-input`)?.value||a,MaxValue:b.querySelector(`.max-value-input`)?.value||a,Period:b.querySelector(i)?.value||a,Type:b.querySelector(j)?.value||c,Send_to:b.querySelector(k)?.value||a};if(m.Name.length===d||m.Name.length>=r){throw new e(s)};if(m.PID.length===d||m.PID.length>=10){throw new e(`PID must not be empty and must be less than 10 characters`)};if(m.Expression.length===d||m.Expression.length>=t){throw new e(`Expression must not be empty and must be less than 64 characters`)};if(!/^\d+$/.test(m.Period)||o(m.Period)<100&&o(m.Period)!=d){throw new e(`Period must be a number greater than 100`)};if(m.Send_to.length>=t){throw new e(u)};v.push(m)})};if(y?.length){y.forEach((b,f)=>{const h={Name:b.querySelector(g)?.value||a,ReceiveHeader:b.querySelector(`.receive-header-input`)?.value||a,Period:b.querySelector(i)?.value||a,Type:b.querySelector(j)?.value||c,Send_to:b.querySelector(k)?.value||a};if(h.Name.length===d||h.Name.length>=r){throw new e(s)};if(!/^\d+$/.test(h.Period)||o(h.Period)<p&&o(h.Period)!=d){throw new e(`Period must be a number greater than 1000`)};if(h.Send_to.length>=t){throw new e(u)};w.push(h)})};const O={initialisation:z,grouping:A,group_dest_type:B,destination:E,cycle:G,car_specific:H,ha_discovery:C,car_model:L,pids:v,std_pids:w,standard_pids:J,ecu_protocol:K,group_api_token:D};await fetch(`store_auto_data`,{method:l,headers:{'Content-Type':m},body:n(O)}).then(a=>a.text()).then(a=>{showNotification(`Settings saved successfully`,`green`);document.querySelector(`.store`).disabled=!0;document.getElementById(`custom_pid_store`).disabled=!0}).catch(a=>{showNotification(`Error saving settings: `+ a.message,q);return !1});return !0}catch(a){showNotification(a.message,q);return !1}});var addSelectedPID=((a={})=>{let d=``,f=`click`,g=`none`,e=`selected`;const b=document.getElementById(`available_pids`);const c=a.Name||b.value;if(c){const b=document.querySelector(`.std-pid-entries`);const h=document.createElement(`div`);h.className=`std-pid-entry`;h.innerHTML=`
            <div class="pid-header">
                <div class="header-left">
                    <button type="button" class="collapse-btn">▼</button>
                    <span class="pid-title">${c}</span>
                </div>
                <div class="header-right">
                    <button type="button" class="delete-btn">Delete</button>
                </div>
            </div>
            <div class="pid-content" style="display: none;">
                <table class="compact-form-table">
                    <tr>
                        <td>Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                        <td><input type="text" class="name-input" value="${c}" readonly></td>
                    </tr>
                    <tr>
                        <td>Receive Header:</td>
                        <td><input type="text" class="receive-header-input" value="${a.ReceiveHeader||d}" 
                            placeholder="Optional Receive Header" maxlength="8"></td>
                    </tr>
                    <tr>
                        <td>Period(ms):</td>
                        <td><input type="number" class="period-input" value="${a.Period||`1000`}" 
                            min="100" max="120000"></td>
                    </tr>
                    <tr>
                        <td>Destination Type:</td>
                        <td><select class="type-select">
                            <option value="Default" ${a.Type===`Default`?e:d}>Default</option>
                            <option value="MQTT_Topic" ${a.Type===`MQTT_Topic`?e:d}>MQTT_Topic</option>
                            <option value="MQTT_WallBox" ${a.Type===`MQTT_WallBox`?e:d}>MQTT_WallBox</option>
                            <option value="HTTP" ${a.Type===`HTTP`?e:d}>HTTP</option>
                            <option value="HTTPS" ${a.Type===`HTTPS`?e:d}>HTTPS</option>
                            <option value="ABRP_API" ${a.Type===`ABRP_API`?e:d}>ABRP_API</option>
                        </select></td>
                    </tr>
                    <tr>
                        <td>Destination:</td>
                        <td><input type="text" class="send-to-input" value="${a.Send_to||d}" 
                            placeholder="Enter destination"></td>
                    </tr>
                </table>
            </div>
        `;const i=document.createElement(`style`);i.textContent=pidEntryStyles;document.head.appendChild(i);const j=h.querySelector(`.pid-header`);const k=h.querySelector(`.delete-btn`);const l=h.querySelector(`.collapse-btn`);const m=h.querySelector(`.pid-content`);k.addEventListener(f,()=>{h.remove();enableAutoStoreButton()});const n=a=>{a.stopPropagation();const b=m.style.display===g;m.style.display=b?`block`:g;l.textContent=b?`▲`:`▼`};j.addEventListener(f,n);l.addEventListener(f,n);h.querySelectorAll(`input, select`).forEach(a=>{a.addEventListener(`input`,enableAutoStoreButton)});b.appendChild(h);enableAutoStoreButton()}});var certManagerRender=(()=>{let b=``,c=`&#10003;`,d=`-`;const a=document.getElementById(`certmgr_body`);if(!a)return;if(certManagerSets.length===0){a.innerHTML=`<tr><td colspan="5" style="padding:8px; text-align:center; color:#555;">No certificate sets</td></tr>`;return};a.innerHTML=certManagerSets.map((a,e)=>{const f=a.readOnly?b:`<button style=\"background:#dc2626; color:#fff; border:none; padding:4px 8px; border-radius:4px; cursor:pointer;\" onclick=\"certManagerDelete('${a.name}')\">Delete</button>`;return `<tr>
                <td style=\"padding:6px; border:1px solid #e2e8f0; font-weight:600;\">${a.name}${a.readOnly?` (single)`:b}</td>
                <td style=\"padding:6px; border:1px solid #e2e8f0;\">${a.has_ca?c:d} </td>
                <td style=\"padding:6px; border:1px solid #e2e8f0;\">${a.has_client_cert?c:d} </td>
                <td style=\"padding:6px; border:1px solid #e2e8f0;\">${a.has_client_key?c:d} </td>
                <td style=\"padding:6px; border:1px solid #e2e8f0;\">${f}</td>
            </tr>`}).join(b)});var toggleSmartConnectConfig=(()=>{let g=`block`,h=`none`;const a=document.getElementById(`wifi_mode`).value;const b=document.getElementById(`smartconnect_config`);const c=document.getElementById(`station_config_section`);const d=document.getElementById(`protocol`);const e=document.getElementById(`add_fallback_button`);const f=document.querySelectorAll(`#fallback_rows input, #fallback_rows select, #fallback_rows button`);if(a===`SmartConnect`){b.style.display=g;c.style.display=h;d.disabled=!0;toggleDriveConfig();if(e)e.disabled=!0;f.forEach(a=>a.disabled=!0)}else{b.style.display=h;c.style.display=g;d.disabled=!1;const a=document.getElementById(`ble_status`);const i=document.getElementById(`ble_pass_value`);a.disabled=!1;i.disabled=!1;if(e)e.disabled=!1;f.forEach(a=>a.disabled=!1)};submit_enable()});var certManagerLoad=(async()=>{try{const a=await fetch(`/cert_manager/sets`);if(!a.ok)throw 0;const b=await a.json();const c=certManagerSets.find(a=>a.readOnly);certManagerSets=[];if(c)certManagerSets.push(c);for(const a of b){certManagerSets.push(a)};certManagerRender()}catch(a){console.log(`cert sets load failed`,a)}});var uploadHttpsCerts=(async()=>{let e=`https_ca_file`,f=0,j=``,h=`https_client_key_file`,i=`red`,g=`https_client_cert_file`;const a=document.getElementById(e).files[f];const b=document.getElementById(g).files[f];const c=document.getElementById(h).files[f];if(!a&&!b&&!c){showNotification(`No certificate files selected`,i);return};const d=document.getElementById(`https_upload_button`);d.disabled=!0;d.value=`Uploading...`;try{const d=new FormData();if(a)d.append(`ca_cert`,a,`ca.pem`);if(b)d.append(`client_cert`,b,`client.crt`);if(c)d.append(`client_key`,c,`client.key`);const f=await fetch(`/cert_manager/upload`,{method:`POST`,body:d});if(!f.ok)throw new Error(`upload status `+ f.status);const i=await f.json().catch(()=>({}));showNotification(`Certificates uploaded (`+ (i.saved_parts||`?`)+ ` parts)`,`green`);document.getElementById(e).value=j;document.getElementById(g).value=j;document.getElementById(h).value=j;await new Promise(a=>setTimeout(a,500));refreshHttpsCertStatus()}catch(a){console.error(`HTTPS cert upload error`,a);showNotification(`Upload failed`,i)}finally{d.disabled=!1;d.value=`Upload`}});var disableSubmitWithError=(a=>{showNotification(a,`red`);return !1});var getElements=(()=>({wifiMode:document.getElementById(`wifi_mode`),wifiScanButton:document.getElementById(`wifi_scan_button`),ssidValue:document.getElementById(`ssid_value`),passValue:document.getElementById(`pass_value`),staSecurity:document.getElementById(`sta_security`),bleStatus:document.getElementById(`ble_status`),apAutoDisable:document.getElementById(`ap_auto_disable`),bleWarningDiv:document.getElementById(`ble_warning_div`),mqttEn:document.getElementById(`mqtt_en`),mqttEnDiv:document.getElementById(`mqtt_en_div`),battAlert:document.getElementById(`batt_alert`),battAlertDiv:document.getElementById(`batt_alert_div`),submitButton:document.getElementById(`submit_button`),apPassValue:document.getElementById(`ap_pass_value`),mqttTxTopic:document.getElementById(`mqtt_tx_topic`),mqttRxTopic:document.getElementById(`mqtt_rx_topic`),mqttStatusTopic:document.getElementById(`mqtt_status_topic`),tcpPortValue:document.getElementById(`tcp_port_value`),battAlertPort:document.getElementById(`batt_alert_port`),blePassValue:document.getElementById(`ble_pass_value`),sleepVolt:document.getElementById(`sleep_volt`),sleepStatus:document.getElementById(`sleep_status`),sleepDisableAgree:document.getElementById(`sleep_disable_agree`),protocol:document.getElementById(`protocol`),portType:document.getElementById(`port_type`),mqttElm327Log:document.getElementById(`mqtt_elm327_log`),periodicWakeup:document.getElementById(`periodic_wakeup`),wakeupEveryRow:document.getElementById(`wakeup_every_row`)}));var getSecurityType=(a=>{switch(a){case `OPEN`:return `Open`;case `WPA_PSK`:return `WPA`;case `WPA2_PSK`:return `WPA2`;case `WPA_WPA2_PSK`:return `WPA/WPA2`;case `WPA2_WPA3_PSK`:return `WPA2/WPA3`;case `WPA3_PSK`:return `WPA3`;default:return a}});var validateForm=((a,b)=>{let l=64,k=`enable`,j=1,i=63,h=8;const c=a.apPassValue.value.length;const d=a.passValue.value.length;if((c<h||c>i)||(d<h||d>i)){return disableSubmitWithError(`AP/Station password length, min=8 max=63`)};if(!validateLength(a.ssidValue.value,j,32)){return disableSubmitWithError(`AP/Station SSID length, min=1 max=32`)};const e=a.mqttEn.value===k;if(e){if(!validateLength(a.mqttTxTopic.value,j,l)){return disableSubmitWithError(`MQTT TX Topic length, min=1 max=64`)};if(!validateLength(a.mqttRxTopic.value,j,l)){return disableSubmitWithError(`MQTT RX Topic length, min=1 max=64`)};if(!validateLength(a.mqttStatusTopic.value,j,l)){return disableSubmitWithError(`MQTT Status Topic length, min=1 max=64`)}};if(!validatePort(a.tcpPortValue.value)){return disableSubmitWithError(`TCP Port value, min=1 max=65535`)};if(!validatePort(a.battAlertPort.value)){return disableSubmitWithError(`Battery Alert Port value, min=1 max=65535`)};const f=a.bleStatus.value===k;if(f){const b=a.blePassValue.value;if(b.length!==6||b.charAt(0)===`0`){return disableSubmitWithError(`BLE Passkey: 6 digits required, first digit cannot be 0`)}};const g=parseFloat(a.sleepVolt.value);if(g<12||g>15){return disableSubmitWithError(`Sleep Voltage Value, min=12.0 max=15.0`)};if(a.sleepStatus.value===`disable`&&a.sleepDisableAgree.value===`no`){return disableSubmitWithError(`You must agree to disable sleep mode`)};if(b===`SmartConnect`){return validateSmartConnect()};return !0});var isNameUnique=(a=>canData.every(b=>b[`Name`]!==a));var mon_button_en=(a=>{let b=`mon_button`,c=`mon_datarate`,d=`mon_filter`,e=`mon_mask`;if(a==1){document.getElementById(b).value=`Start`;document.getElementById(c).disabled=!1;document.getElementById(d).disabled=!1;document.getElementById(e).disabled=!1}else{document.getElementById(b).value=`Stop`;document.getElementById(c).disabled=!0;document.getElementById(d).disabled=!0;document.getElementById(e).disabled=!0}});var restoreCANFLTRow=((a,b,c,d,e,f,g,h)=>{let E=``,B=0,C=536870912,D=1;var i=a;if(i<B){i=B}else if(i>C){i=C};var j=b;var k=c;var l=d;var m=e;var n=f;var o=g;var p=h;var q=document.getElementById(`can_flt_table`);var r=q.insertRow(-D);var s=r.insertCell(B);var t=r.insertCell(D);var u=r.insertCell(2);var v=r.insertCell(3);var w=r.insertCell(4);var x=r.insertCell(5);var y=r.insertCell(6);var z=r.insertCell(7);var A=r.insertCell(8);s.innerHTML=i;t.innerHTML=j;u.innerHTML=k;v.innerHTML=l;w.innerHTML=m;x.innerHTML=n;y.innerHTML=o;z.innerHTML=p;A.innerHTML=`<button style="width: 100%;" onclick="deleteCANFLTRow(this)">Delete</button>`;canData.push({CANID:i,Name:j,PID:k,PIDIndex:l,StartBit:m,BitLength:n,Expression:o,Cycle:p});document.getElementById(`canId`).value=E;document.getElementById(`name`).value=E;document.getElementById(`pid`).value=E;document.getElementById(`pindex`).value=E;document.getElementById(`startBit`).value=E;document.getElementById(`bitLength`).value=E;document.getElementById(`expression`).value=E;document.getElementById(`cycle`).value=E});var postCANFLT=(()=>{var a={};a[`can_flt`]=canData;var b=JSON.stringify(a);const c=new XMLHttpRequest();c.onload=function(){showNotification(this.responseText,`green`);submit_enable()};c.open(`POST`,`/store_canflt`);c.setRequestHeader(`Content-Type`,`application/json`);c.send(b)});var Load=(()=>{let I=`tcp_port_value`,b=`wifi_mode`,q=`can_datarate`,z=`periodic_wakeup`,x=`sleep_status`,H=`protocol`,m=`elm327`,K=7,N=`batt_alert_div`,A=`mqtt_tx_en_checkbox`,u=`port_type`,p=1,w=`disable`,P=`mqtt_en_div`,M=`batt_alert_time`,E=`logger_status`,f=`sta_security`,d=`ssid_value`,c=`1`,r=`6`,C=`mqtt_rx_en_checkbox`,J=`batt_alert`,y=`sleep_disable_agree`,l=`wpa3`,O=`none`,G=`ble_power`,D=`mqtt_rx_topic`,j=`3`,t=`can_mode`,k=``,B=`mqtt_tx_topic`,s=`8`,L=`mqtt_en`,e=`pass_value`,h=`2`,g=`ap_auto_disable`,o=`enable`,F=`log_storage`,i=`0`,n=`60`,v=`ble_status`,Q=Array.isArray;const a=new XMLHttpRequest();a.onload=function(){var a=JSON.parse(this.responseText);if(a.wifi_mode==`APStation`){document.getElementById(b).selectedIndex=c;document.getElementById(d).disabled=!1;document.getElementById(e).disabled=!1;document.getElementById(f).disabled=!1;document.getElementById(g).disabled=!1}else if(a.wifi_mode==`BLEStation`){document.getElementById(b).selectedIndex=h;document.getElementById(d).disabled=!1;document.getElementById(e).disabled=!1;document.getElementById(f).disabled=!1;document.getElementById(g).disabled=!1}else if(a.wifi_mode==`AP`){document.getElementById(b).selectedIndex=i;document.getElementById(d).disabled=!0;document.getElementById(e).disabled=!0;document.getElementById(g).disabled=!0}else if(a.wifi_mode==`SmartConnect`){document.getElementById(b).selectedIndex=j};document.getElementById(`home_ssid`).value=a.home_ssid||k;document.getElementById(`home_password`).value=a.home_password||k;document.getElementById(`home_security`).value=a.home_security||l;document.getElementById(`home_protocol`).value=a.home_protocol||m;document.getElementById(`drive_ssid`).value=a.drive_ssid||k;document.getElementById(`drive_password`).value=a.drive_password||k;document.getElementById(`drive_security`).value=a.drive_security||l;document.getElementById(`drive_protocol`).value=a.drive_protocol||m;document.getElementById(`drive_connection_type`).value=a.drive_connection_type||`wifi`;document.getElementById(`drive_mode_timeout`).value=a.drive_mode_timeout||n;document.getElementById(`drive_mode_timeout_value`).textContent=a.drive_mode_timeout||n;if(a.ap_auto_disable==o){document.getElementById(g).selectedIndex=i}else{document.getElementById(g).selectedIndex=c};var R=parseInt(a.ap_ch);R=R- p;document.getElementById(`ap_ch_value`).selectedIndex=R.toString();document.getElementById(d).value=a.sta_ssid;document.getElementById(e).value=a.sta_pass;document.getElementById(f).value=a.sta_security||l;if(a.can_datarate==`5K`){document.getElementById(q).selectedIndex=i}else if(a.can_datarate==`10K`){document.getElementById(q).selectedIndex=c}else if(a.can_datarate==`20K`){document.getElementById(q).selectedIndex=h}else if(a.can_datarate==`25K`){document.getElementById(q).selectedIndex=j}else if(a.can_datarate==`50K`){document.getElementById(q).selectedIndex=`4`}else if(a.can_datarate==`100K`){document.getElementById(q).selectedIndex=`5`}else if(a.can_datarate==`125K`){document.getElementById(q).selectedIndex=r}else if(a.can_datarate==`250K`){document.getElementById(q).selectedIndex=`7`}else if(a.can_datarate==`500K`){document.getElementById(q).selectedIndex=s}else if(a.can_datarate==`800K`){document.getElementById(q).selectedIndex=`9`}else if(a.can_datarate==`1000K`){document.getElementById(q).selectedIndex=`10`}else if(a.can_datarate==`auto`){document.getElementById(q).selectedIndex=`11`};if(a.can_mode==`normal`){document.getElementById(t).selectedIndex=i}else if(a.can_mode==`silent`){document.getElementById(t).selectedIndex=c};if(a.port_type==`tcp`){document.getElementById(u).selectedIndex=i}else if(a.port_type==`udp`){document.getElementById(u).selectedIndex=c};if(a.ble_status==o){document.getElementById(v).selectedIndex=0}else if(a.ble_status==w){document.getElementById(v).selectedIndex=p};if(a.sleep_status==o){document.getElementById(x).selectedIndex=i}else if(a.sleep_status==w){document.getElementById(x).selectedIndex=c};if(a.sleep_disable_agree==`yes`){document.getElementById(y).selectedIndex=c}else{document.getElementById(y).selectedIndex=i};toggleSleepWarning();if(a.periodic_wakeup==o){document.getElementById(z).selectedIndex=i}else if(a.periodic_wakeup==w){document.getElementById(z).selectedIndex=c};if(`mqtt_tx_en` in a){if(a.mqtt_tx_en===o){document.getElementById(A).checked=!0}else{document.getElementById(A).checked=!1}}else{document.getElementById(A).checked=!1;document.getElementById(B).disabled=!0};if(`mqtt_rx_en` in a){if(a.mqtt_rx_en===o){document.getElementById(C).checked=!0}else{document.getElementById(C).checked=!1}}else{document.getElementById(C).checked=!1;document.getElementById(D).disabled=!0};if(a.logger_status===o){document.getElementById(E).selectedIndex=i}else if(a.logger_status===w){document.getElementById(E).selectedIndex=c};if(a.log_filesystem===`fatfs`){document.getElementById(`log_filesystem`).selectedIndex=i};if(a.log_storage===`sdcard`){document.getElementById(F).selectedIndex=i}else if(a.log_storage===`internal`){document.getElementById(F).selectedIndex=c};document.getElementById(`log_period_value`).textContent=a.log_period;document.getElementById(`imu_threshold`).value=a.imu_threshold||s;document.getElementById(`imu_threshold_value`).textContent=((a.imu_threshold||8)*3.9).toFixed(p)+ ` mg`;const S=G in a?a.ble_power:9;document.getElementById(G).value=S;document.getElementById(`ble_power_value`).textContent=S;txCheckBoxChanged();rxCheckBoxChanged();document.getElementById(H).value=a.protocol;document.getElementById(I).value=a.port;document.getElementById(`ap_pass_value`).value=a.ap_pass;document.getElementById(`ble_pass_value`).value=a.ble_pass;document.getElementById(`sleep_volt`).value=a.sleep_volt;document.getElementById(`sleep_volt_value`).textContent=a.sleep_volt;document.getElementById(`sleep_time`).value=a.sleep_time;document.getElementById(`sleep_time_value`).textContent=a.sleep_time;document.getElementById(`wakeup_interval`).value=a.wakeup_interval;document.getElementById(`wakeup_interval_value`).textContent=a.wakeup_interval;document.getElementById(J).value=w;document.getElementById(`batt_alert_ssid`).value=a.batt_alert_ssid;document.getElementById(`batt_alert_pass`).value=a.batt_alert_pass;document.getElementById(`batt_alert_volt`).value=a.batt_alert_volt;document.getElementById(`batt_alert_protocol`).value=a.batt_alert_protocol;document.getElementById(`batt_alert_url`).value=a.batt_alert_url.slice(K);document.getElementById(`batt_alert_port`).value=a.batt_alert_port;document.getElementById(`batt_alert_topic`).value=a.batt_alert_topic;document.getElementById(`batt_mqtt_user`).value=a.batt_mqtt_user;document.getElementById(`batt_mqtt_pass`).value=a.batt_mqtt_pass;document.getElementById(L).value=a.mqtt_en;document.getElementById(`mqtt_url`).value=a.mqtt_url.slice(K);document.getElementById(`mqtt_port`).value=a.mqtt_port;document.getElementById(`mqtt_user`).value=a.mqtt_user;document.getElementById(`mqtt_pass`).value=a.mqtt_pass;document.getElementById(B).value=a.mqtt_tx_topic;document.getElementById(D).value=a.mqtt_rx_topic;document.getElementById(`mqtt_status_topic`).value=a.mqtt_status_topic;document.getElementById(`mqtt_elm327_log`).value=a.mqtt_elm327_log;if(a.batt_alert_time==c){document.getElementById(M).selectedIndex=i}else if(a.batt_alert_time==r){document.getElementById(M).selectedIndex=c}else if(a.batt_alert_time==`12`){document.getElementById(M).selectedIndex=h}else if(a.batt_alert_time==`24`){document.getElementById(M).selectedIndex=j};if(document.getElementById(H).value==`savvycan`){document.getElementById(I).value=`23`;document.getElementById(I).disabled=!0;document.getElementById(u).selectedIndex=i;document.getElementById(u).disabled=!0};if(document.getElementById(J).value==o){document.getElementById(N).style.display=O}else if(document.getElementById(J).value==w){document.getElementById(N).style.display=O};if(document.getElementById(L).value==o){document.getElementById(P).style.display=`block`}else if(document.getElementById(L).value==w){document.getElementById(P).style.display=O};loadCANFLT();loadautoPIDCarData();loadautoPID();try{const b=Q(a.sta_fallbacks)?a.sta_fallbacks:[];renderFallbackNetworks(b)}catch(a){renderFallbackNetworks([])}document.getElementById(`car_model`).addEventListener(`change`,function(){document.querySelector(`.specific-pid-entries`).innerHTML=k;const a=this.value;if(latest_car_models&&Q(latest_car_models.cars)){const b=latest_car_models.cars.find(b=>b.car_model===a);const c=document.getElementById(`specific_init`);c.value=b.init;if(b&&b.pids){b.pids.forEach(a=>{if(a.parameters){a.parameters.forEach(b=>{addCarParameter({...b,pid:a.pid,pid_init:a.pid_init})})}})}}});document.getElementById(`store_canflt_button`).disabled=!0;document.querySelector(`.store`).disabled=!0;document.getElementById(`submit_button`).disabled=!0};checkStatus();a.open(`GET`,`/load_config`);a.send();toggleSmartConnectConfig();if(typeof lucide!==`undefined`&&lucide.createIcons){lucide.createIcons()}});var handleBleStatus=(a=>{let d=`none`,e=`disable`;const b=a.bleStatus.value===`enable`;const c=a.wifiMode.value===`BLEStation`;a.bleWarningDiv.style.display=b&&!c?`block`:d;a.blePassValue.disabled=!b;if(b&&!window.bleAlertShown){a.mqttEn.value=e;a.mqttEnDiv.style.display=d;a.mqttEn.disabled=!0;a.battAlert.value=e;a.battAlertDiv.style.display=d;a.battAlert.disabled=!0;window.bleAlertShown=!0}else if(!b){a.mqttEn.disabled=!1;a.battAlert.disabled=!0}});var toggleGroupApiToken=(()=>{const a=document.getElementById(`group_dest_type`).value;const b=document.getElementById(`group_api_token_row`);if(a===`HTTP`||a===`HTTPS`||a===`ABRP_API`){b.style.display=`table-row`}else{b.style.display=`none`}});var toggleStandardPIDOptions=(()=>{const a=document.getElementById(`standard_pids`);const b=document.getElementById(`ecu_protocol`);const c=document.getElementById(`available_pids`);const d=document.getElementById(`scan_pids_button`);const e=a.value===`enable`;b.disabled=!e;c.disabled=!e;d.disabled=!e});var openTab=((a,b)=>{let f=0,g=` active`;var c,d,e;d=document.getElementsByClassName(`tabcontent`);for(c=f;c<d.length;c++){d[c].style.display=`none`};e=document.getElementsByClassName(`tablinks`);for(c=f;c<e.length;c++){e[c].className=e[c].className.replace(g,``)};document.getElementById(b).style.display=`block`;a.currentTarget.className+=g;if(b===`dashboard_tab`){loadDashboard()}else if(b===`system_tab`){if(typeof certManagerLoad===`function`)certManagerLoad()}});var addCarParameter=((a={})=>{let b=``,d=`click`,e=`none`,c=`selected`;if(a.name){const f=document.querySelector(`.specific-pid-entries`);const g=document.createElement(`div`);g.className=`specific-pid-entry`;g.innerHTML=`
            <div class="pid-header">
                <div class="header-left">
                    <button type="button" class="collapse-btn">▼</button>
                    <span class="pid-title">${a.name}</span>
                </div>
                <div class="header-right">
                    <button type="button" class="delete-btn">Delete</button>
                </div>
            </div>
            <div class="pid-content" style="display: none;">
                <table class="compact-form-table">
                    <tr>
                        <td>Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                        <td><input type="text" class="name-input" value="${a.name}"></td>
                    </tr>
                    <tr>
                        <td>PID:</td>
                        <td><input type="text" class="pid-input" value="${a.pid||b}" placeholder="PID"></td>
                    </tr>
                    <tr>
                        <td>PID Init:</td>
                        <td><input type="text" class="pid-init-input" value="${a.pid_init||b}" placeholder="Init"></td>
                    </tr>
                    <tr>
                        <td>Expression:</td>
                        <td><input type="text" class="expression-input" value="${a.expression||b}" placeholder="Expression"></td>
                    </tr>
                    <tr>
                        <td>Unit:</td>
                        <td><input type="text" class="unit-input" value="${a.unit||b}" placeholder="Unit"></td>
                    </tr>
                    <tr>
                        <td>Class:</td>
                        <td><input type="text" class="class-input" value="${a.class||b}" placeholder="Class"></td>
                    </tr>

                    <tr>
                        <td>Min Value:</td>
                        <td><input type="number" class="min-input" value="${a.min||b}" step="0.01" placeholder="Min"></td>
                    </tr>
                    <tr>
                        <td>Max Value:</td>
                        <td><input type="number" class="max-input" value="${a.max||b}" step="0.01" placeholder="Max"></td>
                    </tr>
                    <tr>
                        <td>Period(ms):</td>
                        <td><input type="number" class="period-input" value="${a.period||`5000`}" min="100" max="60000"></td>
                    </tr>
                    <tr>
                        <td>Destination Type:</td>
                        <td><select class="type-select">
                            <option value="Default" ${a.type===`Default`?c:b}>Default</option>
                            <option value="MQTT_Topic" ${a.type===`MQTT_Topic`?c:b}>MQTT_Topic</option>
                            <option value="MQTT_WallBox" ${a.type===`MQTT_WallBox`?c:b}>MQTT_WallBox</option>
                            <option value="HTTP" ${a.type===`HTTP`?c:b}>HTTP</option>
                            <option value="HTTPS" ${a.type===`HTTPS`?c:b}>HTTPS</option>
                            <option value="ABRP_API" ${a.type===`ABRP_API`?c:b}>ABRP_API</option>
                        </select></td>
                    </tr>
                    <tr>
                        <td>Destination:</td>
                        <td><input type="text" class="send-to-input" value="${a.send_to||b}" 
                            placeholder="Destination"></td>
                    </tr>
                </table>
            </div>
        `;const h=document.createElement(`style`);h.textContent=pidEntryStyles;document.head.appendChild(h);const i=g.querySelector(`.pid-header`);const j=g.querySelector(`.delete-btn`);const k=g.querySelector(`.collapse-btn`);const l=g.querySelector(`.pid-content`);j.addEventListener(d,()=>{g.remove();enableAutoStoreButton()});const m=a=>{a.stopPropagation();const b=l.style.display===e;l.style.display=b?`block`:e;k.textContent=b?`▲`:`▼`};i.addEventListener(d,m);k.addEventListener(d,m);g.querySelectorAll(`input, select`).forEach(a=>{a.addEventListener(`input`,enableAutoStoreButton)});f.appendChild(g);enableAutoStoreButton()}});var addCollapsibleRow=((a={})=>{let q=`none`,o=`selected`,n=``,p=`click`,r=`input`;const b=document.querySelector(`.pid-entries`);const c=document.createElement(`div`);c.className=`pid-entry`;c.innerHTML=`
            <div class="pid-header">
                <div class="header-left">
                    <button type="button" class="collapse-btn">▼</button>
                    <span class="pid-title">New PID</span>
                </div>
                <div class="header-right">
                    <button type="button" class="delete-btn">Delete</button>
                </div>
            </div>
            <div class="pid-content hidden">
                <table class="compact-form-table">
                    <tr>
                        <td>Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                        <td><input type="text" class="name-input" value="${a.Name||n}" 
                            placeholder="Parameter Name"></td>
                    </tr>
                    <tr>
                        <td>Init:</td>
                        <td><input type="text" class="init-input" value="${a.Init||n}" 
                            placeholder="PID Init"></td>
                    </tr>
                    <tr>
                        <td>PID:</td>
                        <td><input type="text" class="pid-input" value="${a.PID||n}" 
                            placeholder="PID"></td>
                    </tr>
                    <tr>
                        <td>Expression:</td>
                        <td><input type="text" class="expression-input" value="${a.Expression||n}" 
                            placeholder="Enter expression"></td>
                    </tr>
                    <tr>
                        <td>Min Value:</td>
                        <td><input type="number" class="min-value-input" value="${a.MinValue||n}" 
                            step="0.01" placeholder="Minimum value"></td>
                    </tr>
                    <tr>
                        <td>Max Value:</td>
                        <td><input type="number" class="max-value-input" value="${a.MaxValue||n}" 
                            step="0.01" placeholder="Maximum value"></td>
                    </tr>
                    <tr>
                        <td>Period(ms):</td>
                        <td><input type="number" class="period-input" value="${a.Period||n}" 
                            placeholder="ms"></td>
                    </tr>
                    <tr>
                        <td>Destination Type:</td>
                        <td><select class="type-select">
                            <option value="Default" ${a.Type===`Default`?o:n}>Default</option>
                            <option value="MQTT_Topic" ${a.Type===`MQTT_Topic`?o:n}>MQTT_Topic</option>
                            <option value="MQTT_WallBox" ${a.Type===`MQTT_WallBox`?o:n}>MQTT_WallBox</option>
                            <option value="HTTP" ${a.Type===`HTTP`?o:n}>HTTP</option>
                            <option value="HTTPS" ${a.Type===`HTTPS`?o:n}>HTTPS</option>
                            <option value="ABRP_API" ${a.Type===`ABRP_API`?o:n}>ABRP_API</option>
                        </select></td>
                    </tr>
                    <tr>
                        <td>Send_to:</td>
                        <td><input type="text" class="send-to-input" value="${a.Send_to||n}"
                            placeholder="Enter destination"></td>
                    </tr>
                </table>
            </div>
        `;console.log(`addCollapsibleRow:`,a);console.log(`Send_to value:`,a.Send_to);const d=document.createElement(`style`);d.textContent=pidEntryStyles;document.head.appendChild(d);const e=c.querySelector(`.pid-header`);const f=c.querySelector(`.delete-btn`);const g=c.querySelector(`.collapse-btn`);const h=c.querySelector(`.pid-content`);const i=c.querySelector(`.pid-title`);const j=c.querySelector(`.name-input`);const k=c.querySelector(`.pid-input`);f.addEventListener(p,()=>{c.remove();enableAutoStoreButton()});const l=a=>{a.stopPropagation();const b=h.style.display===q||getComputedStyle(h).display===q;h.style.display=b?`block`:q;g.textContent=b?`▲`:`▼`};e.addEventListener(p,l);g.addEventListener(p,l);i.textContent=a.Name?a.Name:`New PID`;const m=()=>{i.textContent=`${j.value||`New Parameter`}`};j.addEventListener(r,m);k.addEventListener(r,m);c.querySelectorAll(`input, select`).forEach(a=>{a.addEventListener(r,enableAutoStoreButton)});b.appendChild(c)});var mon_control=(()=>{var a=document.getElementById(`mon_datarate`).selectedIndex;var b=window.location.href;var c=`http://192.168.31.72/`;console.log(a);alert(`Please reboot device after Monitor, otherwise the device may not function as expected`);ws_url=`ws://`+ b.substr(7,b.length)+ `ws`;console.log(ws_url);if(document.getElementById(`mon_button`).value==`Start`){ws=new WebSocket(ws_url);setTimeout(bindEvents,1000);ws.addEventListener(`open`,b=>{var c=`C`+ cr+ `S`+ a+ cr+ `O`+ cr;console.log(`onopen called`);ws.send(c);window.mon_button_en(0)});ws.addEventListener(`close`,a=>{window.mon_button_en(1);console.log(`onclose called`)})}else{ws_close()}});var reboot=(()=>{const a=new XMLHttpRequest();document.getElementById(`reboot_button`).disabled=!0;showNotification(`Rebooting please reconnect...`,`yellow`);a.open(`POST`,`/system_reboot`);a.send(`reboot`)});var configureMqttAndBatteryAlerts=(a=>{let c=`none`;a.battAlertDiv.style.display=c;const b=a.mqttEn.value===`enable`;a.mqttEnDiv.style.display=b?`block`:c});var configureSleepSettings=(a=>{let d=`enable`;const b=a.sleepStatus.value===d;const c=a.bleStatus.value===d;if(b){if(!c){a.battAlert.disabled=!0}}else{a.battAlert.disabled=!0;a.battAlert.selectedIndex=0}});var validateLength=((a,b,c,d)=>{const e=a.length;return e>=b&&e<=c});var convertSingleCarFormat=((a,b)=>{const c={car_model:a.car_model,init:a.init,pids:[]};a.pids.forEach(a=>{const d={pid:a.pid,parameters:[]};if(a.pid_init){d.pid_init=a.pid_init};if(a.parameters&&typeof a.parameters===`object`){Object.keys(a.parameters).forEach(c=>{const e=a.parameters[c];const f=b[c]||{};const g={name:c,expression:e,unit:f.settings?.unit||``,class:f.settings?.class||`none`};d.parameters.push(g)})};c.pids.push(d)});return c});var scanAvailablePIDs=(async()=>{let c=`red`;const a=document.querySelector(`#scan_pids_button`);const b=document.querySelector(`#add_pid_button`);try{a.disabled=!0;a.textContent=`Scanning...`;b.disabled=!0;const d=document.getElementById(`ecu_protocol`).value;const e=await fetch(`/scan_available_pids?protocol=${d}`);if(!e.ok){throw new Error(`HTTP error! status: ${e.status}`)};const f=await e.json();const g=document.getElementById(`available_pids`);g.innerHTML=``;if(f.text){showNotification(f.text,c)}else if(f.std_pids&&Array.isArray(f.std_pids)&&f.std_pids.length>0){f.std_pids.forEach(a=>{const b=document.createElement(`option`);b.value=a;b.textContent=a;g.appendChild(b)});b.disabled=!1;showNotification(`PID scan complete`,`green`)}else{showNotification(`No PIDs found. Try a different protocol or check if ignition is ON`,`orange`)}}catch(a){console.error(`Error:`,a);showNotification(`PID scan failed: `+ a.message,c)}finally{a.disabled=!1;a.textContent=`Scan PIDs`}});var addFallbackNetworkRow=((a={})=>{let e=``,f=`&quot;`,g=`wpa3`,h=`selected`;const b=document.getElementById(`fallback_rows`);if(!b)return;const c=b.querySelectorAll(`.fallback-row`).length;if(c>=5)return;const d=document.createElement(`div`);d.className=`fallback-row`;d.style.display=`grid`;d.style.gridTemplateColumns=`1fr 1fr 120px auto`;d.style.gap=`8px`;d.style.margin=`6px 0`;d.innerHTML=`
                <input type="text" class="fb-ssid" placeholder="SSID" value="${(a.ssid||e).replace(/"/g,f)}" oninput="submit_enable();" />
                <input type="text" class="fb-pass" placeholder="Password" value="${(a.pass||a.password||e).replace(/"/g,f)}" oninput="submit_enable();" />
                <select class="fb-sec" onchange="submit_enable();">
                    <option value="wpa3" ${(a.security||g)===g?h:e}>WPA3</option>
                    <option value="wpa2" ${(a.security||g)===`wpa2`?h:e}>WPA2</option>
                </select>
                <button type="button" class="fb-remove" onclick="removeFallbackRow(this)">Remove</button>
            `;b.appendChild(d);updateAddFallbackButtonState();submit_enable()});var addRowAutoTable=(()=>{addCollapsibleRow();enableAutoStoreButton()});var send_system_command=(a=>{const b=new XMLHttpRequest();const c={"command":a};b.open(`POST`,`/system_commands`);b.send(JSON.stringify(c))});var checkFirmwareUpdate=(async()=>{try{const a=document.getElementById(`fw_version`)?.textContent?.trim();if(!a)return;const b=await fetch(`https://api.github.com/repos/meatpiHQ/wican-fw/releases`);if(!b.ok)return;const c=await b.json();const d=c.find(a=>a.name&&a.name.toUpperCase().includes(`PRO`)||a.tag_name&&a.tag_name.toUpperCase().includes(`P`));if(!d)return;const e=d.name.match(/v(\d+\.\d+)/i);const f=e?e[1]:null;if(!f)return;if(a.replace(/[^\d.]/g,``)!==f){const a=document.getElementById(`firmware-update-notice`);if(a){const b=d.html_url||`https://github.com/meatpiHQ/wican-fw/releases`;let c=` <span style='color:#b45309'>(v${f})</span>`;a.innerHTML=`<span style=\"font-weight: 600;\">New firmware available!</span><br><a id=\"firmware-update-link\" href=\"${b}\" target=\"_blank\" style=\"color: #2563eb; text-decoration: underline;\">Download</a>${c}`;a.style.display=`block`}}}catch(a){}});var certManagerValidateName=(a=>/^[A-Za-z0-9_-]{1,24}$/.test(a));var loadDashboard=(()=>{window.location.href=`/dashboard.html`});var certManagerDelete=(async(a)=>{let b=`red`;if(!confirm(`Delete certificate set '${a}'?`))return;try{const c=await fetch(`/cert_manager/sets/`+ encodeURIComponent(a),{method:`DELETE`});if(!c.ok){showNotification(`Delete failed`,b);return};showNotification(`Deleted`,`green`);certManagerLoad()}catch(a){showNotification(`Delete error`,b)}});var toggleHttpsCertUploadVisibility=(()=>{let d=`none`;const a=document.getElementById(`https_trust_source`).value===`uploaded`;const b=document.getElementById(`https_cert_upload_table`);if(b)b.style.display=a?`table`:d;const c=[`https_ca_row`,`https_client_cert_row`,`https_client_key_row`];c.forEach(b=>{const c=document.getElementById(b);if(c)c.style.display=a?`table-row`:d})});var ws_close=(()=>{ws.send(`C`+ cr);ws.close()});var scanWifiNetworks=(async()=>{let e=`yellow`,f=`red`,d=Error;const a=document.getElementById(`wifi_scan_button`);const b=document.getElementById(`wifi_networks_list`);const c=document.getElementById(`wifi_networks_row`);try{a.disabled=!0;a.textContent=`Scanning...`;const g=await fetch(`/wifi_scan`);if(!g.ok){throw new d(`HTTP error! status: ${g.status}`)};const h=await g.text();b.innerHTML=`<option value="">Select a network...</option>`;if(h&&h!==`NONE`){try{const a=JSON.parse(h);if(a.networks&&Array.isArray(a.networks)){const d=a.networks.filter(a=>a.ssid&&a.ssid.trim()!==``).sort((a,b)=>b.rssi- a.rssi);const f=[];const g=new Set();d.forEach(a=>{if(!g.has(a.ssid)){g.add(a.ssid);f.push(a)}});if(f.length>0){f.forEach(a=>{const c=document.createElement(`option`);c.value=a.ssid;const d=getSignalQuality(a.rssi);const e=getSecurityType(a.auth_mode);c.textContent=`${a.ssid} (${d}, ${a.rssi} dBm, ${e})`;b.appendChild(c)});c.style.display=`table-row`;showNotification(`Found ${f.length} WiFi networks`,`green`)}else{showNotification(`No valid networks found`,e)}}else{throw new d(`Invalid scan data format`)}}catch(a){console.error(`Parse error:`,a);showNotification(`Failed to parse scan results`,f)}}else{showNotification(`No networks found`,e)}}catch(a){console.error(`WiFi scan error:`,a);showNotification(`WiFi scan failed: `+ a.message,f)}finally{a.disabled=!1;a.textContent=`Scan`}});var toggleSleepWarning=(()=>{const a=document.getElementById(`sleep_status`).value;const b=document.getElementById(`sleep_warning_div`);const c=document.getElementById(`sleep_disable_agree`);if(a===`disable`){b.style.display=`block`;c.value=`no`}else{b.style.display=`none`}});var loadAutoTable=(a=>{let b=``,f=`standard_pids`,k=`change`,h=`group_dest_type`,l=`function`,c=`car_specific`,d=`disable`,e=`grouping`,g=`ecu_protocol`,i=`Default`,j=Array.isArray;try{console.log(`Raw jsonData:`,a);const m=a;const n=document.getElementById(`initialisation`);if(n){n.value=m.initialisation||b};const o=document.getElementById(`automate_table`);if(!o){console.error(`Automate table not found`);return};const p=(a,c,d=b)=>{const e=document.getElementById(a);if(e){e.value=c||d}};p(c,m.car_specific,d);p(`ha_discovery`,d);p(e,m.grouping,d);p(`group_cycle`,m.cycle,`5000`);p(`destination`,m.destination,b);p(`car_model`,m.car_model,b);p(f,m.standard_pids,d);p(g,m.ecu_protocol,`6`);p(h,m.group_dest_type,i);p(`group_api_token`,m.group_api_token,b);if(m.pids&&j(m.pids)){m.pids.forEach((a,c)=>{console.log(`Loading PID ${c}:`,a);addCollapsibleRow({Name:a.Name||b,Init:a.Init||b,PID:a.PID||b,Expression:a.Expression||b,MinValue:a.MinValue||b,MaxValue:a.MaxValue||b,Period:a.Period||b,Type:a.Type||i,Send_to:a.Send_to||b})})};if(m.std_pids&&j(m.std_pids)){m.std_pids.forEach((a,c)=>{console.log(`Loading Standard PID ${c}:`,a);addSelectedPID({Name:a.Name||b,ReceiveHeader:a.ReceiveHeader||b,Period:a.Period||b,Type:a.Type||i,Send_to:a.Send_to||b})})};requestAnimationFrame(()=>{try{const a=document.getElementById(c);if(a){a.dispatchEvent(new Event(k))};const b=document.getElementById(e);if(b){b.dispatchEvent(new Event(k))};const d=document.getElementById(h);if(d){d.dispatchEvent(new Event(k))};const i=document.getElementById(g);if(i){i.dispatchEvent(new Event(k))};const j=document.getElementById(f);if(j){j.dispatchEvent(new Event(k))};if(typeof toggleCarModel===l)toggleCarModel();if(typeof toggleDestinationAndCycle===l)toggleDestinationAndCycle();if(typeof toggleSendToFields===l)toggleSendToFields();if(typeof toggleGroupApiToken===l)toggleGroupApiToken();if(typeof toggleStandardPIDOptions===l)toggleStandardPIDOptions()}catch(a){console.error(`Error in UI updates:`,a)}});console.log(`loadAutoTable completed successfully`)}catch(a){console.error(`Error in loadAutoTable:`,a);showNotification(`Error loading table data: `+ a.message,`red`)}});var storeCANFLT=(()=>{postCANFLT();document.getElementById(`store_canflt_button`).disabled=!0});var toggleDriveConfig=(()=>{let i=`none`,h=`table-row`;const a=document.getElementById(`wifi_mode`).value;const b=document.getElementById(`drive_connection_type`).value;const c=document.getElementById(`drive_wifi_config`);const d=document.getElementById(`drive_wifi_password`);const e=document.getElementById(`drive_wifi_security`);const f=document.getElementById(`ble_status`);const g=document.getElementById(`ble_pass_value`);if(a===`SmartConnect`){if(b===`wifi`){c.style.display=h;d.style.display=h;e.style.display=h;f.value=`disable`;f.selectedIndex=1;f.disabled=!0;g.disabled=!0}else if(b===`ble`){c.style.display=i;d.style.display=i;e.style.display=i;f.value=`enable`;f.selectedIndex=0;f.disabled=!0;g.disabled=!1}};submit_enable()});var alert_elm327=(()=>{alert(`If elm327 log is enabled then only CAN frames proccessed by elm327 will be sent to MQTT broker.`)});var deleteCANFLTRow=(a=>{let e=1;var b=a.parentNode.parentNode;var c=b.cells[0].textContent;var d=canData.findIndex(a=>a[`CANID`]===parseInt(c));if(d!==-e){canData.splice(d,e)};b.parentNode.removeChild(b);document.getElementById(`store_canflt_button`).disabled=!1});var uploadCfg=(async()=>{let e=JSON;const a=document.getElementById(`fileInput`);const b=a.files[0];if(!b)return;const c={'config':`/store_config`,'auto_pid':`/store_auto_data`,'auto_pid_car_data':`/store_car_data`,'canflt':`/store_canflt`};const d=200;try{const f=new FileReader();f.onload=(async(b)=>{try{const f=e.parse(b.target.result);let g=!1;for(const [a,b] of Object.entries(c)){if(f[a]){try{const c=await fetch(b,{method:`POST`,headers:{'Content-Type':`application/json`},body:e.stringify(f[a])});if(!c.ok){g=!0;throw new Error(`HTTP error! status: ${c.status}`)};await new Promise(a=>setTimeout(a,d))}catch(a){g=!0}}};if(g){alert(`Some configurations failed to upload`)}else{alert(`Configuration uploaded successfully, Rebooting...`)};a.value=``}catch(a){alert(`Failed to parse configuration file`)}});f.onerror=(()=>{alert(`Error reading file`)});f.readAsText(b)}catch(a){alert(`Upload failed`)}});var postConfig=(async()=>{let u=`can_datarate`,G=`batt_alert`,q=`home_protocol`,B=`sleep_disable_agree`,C=`periodic_wakeup`,U=`mqtt_port`,N=`batt_alert_port`,z=`ble_power`,M=`batt_alert_url`,T=`mqtt_url`,a0=`mqtt_rx_topic`,k=`home_ssid`,v=`can_mode`,A=`sleep_status`,X=`mqtt_tx_topic`,m=`home_security`,x=`protocol`,t=`drive_mode_timeout`,S=`mqtt_en`,a5=`log_filesystem`,a8=`imu_threshold`,l=`home_password`,F=`wakeup_interval`,Y=`ap_auto_disable`,R=`batt_mqtt_pass`,w=`port_type`,_=`enable`,E=`sleep_time`,I=`batt_alert_pass`,a7=`log_period`,a6=`log_storage`,s=`drive_connection_type`,$=`disable`,n=`drive_ssid`,r=`drive_protocol`,a1=`mqtt_rx_en`,V=`mqtt_user`,K=`batt_alert_protocol`,a3=`mqtt_elm327_log`,D=`sleep_volt`,L=`mqtt://`,P=`batt_alert_time`,W=`mqtt_pass`,H=`batt_alert_ssid`,a4=`logger_status`,J=`batt_alert_volt`,j=`sta_security`,p=`drive_security`,a2=`mqtt_status_topic`,O=`batt_alert_topic`,Q=`batt_mqtt_user`,Z=`mqtt_tx_en`,y=`ble_status`,o=`drive_password`,i=`wifi_mode`;var a={};await new Promise(a=>setTimeout(a,1000));const b=await storeAutoTableData();if(!b){return};a[i]=document.getElementById(i).value;a[`ap_ch`]=document.getElementById(`ap_ch_value`).value;a[`sta_ssid`]=document.getElementById(`ssid_value`).value;a[`sta_pass`]=document.getElementById(`pass_value`).value;a[j]=document.getElementById(j).value;a[k]=document.getElementById(k).value;a[l]=document.getElementById(l).value;a[m]=document.getElementById(m).value;a[n]=document.getElementById(n).value;a[o]=document.getElementById(o).value;a[p]=document.getElementById(p).value;a[q]=document.getElementById(q).value;a[r]=document.getElementById(r).value;a[s]=document.getElementById(s).value;a[t]=document.getElementById(t).value;a[u]=document.getElementById(u).value;a[v]=document.getElementById(v).value;a[w]=document.getElementById(w).value;a[`port`]=document.getElementById(`tcp_port_value`).value;a[`ap_pass`]=document.getElementById(`ap_pass_value`).value;a[x]=document.getElementById(x).value;a[`ble_pass`]=document.getElementById(`ble_pass_value`).value;a[y]=document.getElementById(y).value;a[z]=document.getElementById(z).value;a[A]=document.getElementById(A).value;a[B]=document.getElementById(B).value;a[C]=document.getElementById(C).value;a[D]=document.getElementById(D).value;a[E]=document.getElementById(E).value;a[F]=document.getElementById(F).value;a[G]=document.getElementById(G).value;a[H]=document.getElementById(H).value;a[I]=document.getElementById(I).value;a[J]=document.getElementById(J).value;a[K]=document.getElementById(K).value;let c=L;let d=c.concat(document.getElementById(M).value);a[M]=d;a[N]=document.getElementById(N).value;a[O]=document.getElementById(O).value;a[P]=document.getElementById(P).value;a[Q]=document.getElementById(Q).value;a[R]=document.getElementById(R).value;a[S]=document.getElementById(S).value;let e=L;let f=c.concat(document.getElementById(T).value);a[T]=f;a[U]=document.getElementById(U).value;a[V]=document.getElementById(V).value;a[W]=document.getElementById(W).value;a[X]=document.getElementById(X).value;a[Y]=document.getElementById(Y).value;if(document.getElementById(`mqtt_tx_en_checkbox`).checked){a[Z]=_}else{a[Z]=$};a[a0]=document.getElementById(a0).value;if(document.getElementById(`mqtt_rx_en_checkbox`).checked){a[a1]=_}else{a[a1]=$};a[a2]=document.getElementById(a2).value;a[a3]=document.getElementById(a3).value;a[a4]=document.getElementById(a4).value;a[a5]=document.getElementById(a5).value;a[a6]=document.getElementById(a6).value;a[a7]=document.getElementById(a7).value;a[a8]=document.getElementById(a8).value;try{const b=document.querySelectorAll(`#fallback_rows .fallback-row`);const c=[];b.forEach(a=>{const b=a.querySelector(`.fb-ssid`).value.trim();const d=a.querySelector(`.fb-pass`).value;const e=a.querySelector(`.fb-sec`).value;if(b){c.push({ssid:b,pass:d,security:e})}});a[`sta_fallbacks`]=c.slice(0,5)}catch(a){console.warn(`fallback networks parse error`,a)}var g=JSON.stringify(a);const h=new XMLHttpRequest();h.onload=function(){showNotification(this.responseText,`green`);document.getElementById(`submit_button`).disabled=!0};h.onerror=(()=>{showNotification(`Failed to save configuration`,`red`)});h.open(`POST`,`/store_config`);h.setRequestHeader(`Content-Type`,`application/json`);h.send(g)});var removeFallbackRow=(a=>{const b=a.closest(`.fallback-row`);if(b)b.remove();updateAddFallbackButtonState();submit_enable()});var toggleDestinationAndCycle=(()=>{const a=document.getElementById(`grouping`).value;const b=document.getElementById(`destination`);const c=document.getElementById(`group_cycle`);const d=document.getElementById(`group_dest_type`);if(a===`enable`){b.disabled=!1;c.disabled=!1;d.disabled=!1}else{b.disabled=!0;c.disabled=!0;d.disabled=!0}});var toggleCarModel=(()=>{const a=document.getElementById(`car_specific`).value;const b=document.getElementById(`car_model`);if(a===`disable`){b.disabled=!0}else{b.disabled=!1};toggleDiscovery()});var downloadCfg=(async()=>{let e=0,f=Error;const a=[`/load_config`,`/load_auto_pid_car_data`,`/load_auto_pid`,`/load_canflt`];const b=500;let c={};let d=!1;try{for(let g=e;g<a.length;g++){const e=a[g];try{const a=await fetch(e);if(!a.ok){throw new f(`HTTP error! status: ${a.status}`)};const b=await a.json();const d=e.replace(`/load_`,``);c[d]=b}catch(a){d=!0}if(g<a.length- 1){await new Promise(a=>setTimeout(a,b))}};if(Object.keys(c).length===e){throw new f(`No data was successfully fetched from any endpoint`)};const g=JSON.stringify(c,null,2);const h=new Blob([g],{type:`application/json`});const i=window.URL.createObjectURL(h);const j=document.createElement(`a`);j.href=i;j.download=`config_${new Date().toISOString().split(`T`)[e]}.json`;document.body.appendChild(j);j.click();document.body.removeChild(j);window.URL.revokeObjectURL(i);return !0}catch(a){alert(`Failed to download configuration`);return !1}});document.addEventListener(`DOMContentLoaded`,a=>{document.getElementById(`submit_button`).disabled=!0;setRTCTime()});let latest_car_models=null;let bleAlertShown=!1;const pidEntryStyles=`
        .pid-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            margin-top: 0.5rem;
            border: 2px solid var(--gray-300);
            border-radius: 8px;
        }
        
        .header-right {
            display: flex;
            gap: 0.5rem;
        }
        
        .collapse-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.25rem 0.5rem;
            color: var(--gray-700);
        }
        
        .pid-content {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            transition: height 0.3s ease;
        }
        
        .pid-content.hidden {
            display: none;
        }
    `;var canData=[];document.getElementById(`defaultOpen`).click();var ws=null;var cr=String.fromCharCode(13);let certManagerSets=[]</script><script src=/lucide_icons.js></script></body></html>